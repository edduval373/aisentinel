,RZ=ke.object({name:ke.string().min(1,"Name is required"),provider:ke.string().min(1,"Provider is required"),modelId:ke.string().min(1,"Model ID is required"),description:ke.string().optional(),contextWindow:ke.number().min(1).max(2e6),isEnabled:ke.boolean().default(!0),capabilities:ke.array(ke.string()).optional()}),DZ={openai:"https://api.openai.com/v1",anthropic:"https://api.anthropic.com/v1","google-ai":"https://generativelanguage.googleapis.com/v1",perplexity:"https://api.perplexity.ai",cohere:"https://api.cohere.ai/v1",mistral:"https://api.mistral.ai/v1",custom:""},SE=["text-generation","image-analysis","code-generation","real-time-search","function-calling","multimodal"];function PZ(){const[e,t]=E.useState(!1),[n,r]=E.useState(!1),[s,o]=E.useState(null),[a,l]=E.useState("basic"),{toast:c}=Mt(),u=Xn(),{user:d,isAuthenticated:p,isSuperUser:f}=Nt(),h=f;if(!h)return i.jsx(qe,{title:"Access Denied",subtitle:"Super-user privileges required",children:i.jsxs("div",{style:{padding:"48px",textAlign:"center",backgroundColor:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca"},children:[i.jsx("div",{style:{width:"64px",height:"64px",backgroundColor:"#dc2626",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px auto"},children:i.jsx(Ti,{style:{width:"32px",height:"32px",color:"white"}})}),i.jsx("h2",{style:{fontSize:"24px",fontWeight:"600",color:"#991b1b",margin:"0 0 12px 0"},children:"Access Restricted"}),i.jsxs("p",{style:{fontSize:"16px",color:"#7f1d1d",margin:"0 0 16px 0",lineHeight:"1.5"},children:["Creating AI model templates requires super-user privileges (role level 1000+).",i.jsx("br",{}),"Current role level: ",(d==null?void 0:d.roleLevel)||0]}),i.jsx("p",{style:{fontSize:"14px",color:"#991b1b",margin:0,fontStyle:"italic"},children:"Contact your system administrator to request elevated access."})]})});const{data:y=[],isLoading:g,error:S,isError:b,refetch:x}=ct({queryKey:["/api/admin/ai-model-templates"],staleTime:0,gcTime:5*60*1e3}),{data:v=[],isLoading:T,error:R}=ct({queryKey:["/api/admin/ai-providers"],staleTime:5*60*1e3});Le.useEffect(()=>{console.log("ðŸ”§ [CREATE-MODELS] Providers query state:",{isLoading:T,hasError:!!R,error:R,providersCount:(v==null?void 0:v.length)||0,providers:v})},[v,T,R]);const w=v.map(j=>({value:j.name,label:j.displayName,defaultEndpoint:DZ[j.name]||""})),L=ls({resolver:cs(RZ),defaultValues:{name:"",provider:"",modelId:"",description:"",contextWindow:4096,isEnabled:!0,capabilities:[]}}),U=st({mutationFn:async j=>{const A=localStorage.getItem("sessionToken")||localStorage.getItem("authToken"),M={"Content-Type":"application/json"};A&&(M.Authorization=`Bearer ${A}`,M["X-Session-Token"]=A);const G=await fetch("/api/admin/ai-model-templates",{method:"POST",headers:M,body:JSON.stringify(j)});if(!G.ok){const N=await G.json().catch(()=>({message:"Unknown error"}));throw new Error(N.message||`HTTP ${G.status}`)}return G.json()},onSuccess:async j=>{console.log("âœ… [TEMPLATE CREATE] Success callback executed with data:",j),console.log("âœ… [TEMPLATE CREATE] Invalidating queries..."),await u.invalidateQueries({queryKey:["/api/admin/ai-model-templates"]}),console.log("âœ… [TEMPLATE CREATE] Refetching templates manually..."),await x(),console.log("âœ… [TEMPLATE CREATE] Setting showCreateDialog to false..."),t(!1),console.log("âœ… [TEMPLATE CREATE] Resetting form..."),L.reset(),console.log("âœ… [TEMPLATE CREATE] Showing success toast..."),c({title:"Template Created",description:"AI model template has been created successfully"}),console.log("âœ… [TEMPLATE CREATE] Success callback completed - modal should close")},onError:j=>{console.error("Create template error:",j),c({title:"Creation Failed",description:j.message||"Failed to create AI model template. Please try again."})}}),Y=st({mutationFn:async({id:j,...A})=>{console.log(`ðŸ”§ [TEMPLATE UPDATE] Starting update for template ID: ${j}`),console.log("ðŸ”§ [TEMPLATE UPDATE] Update data:",A);const M=localStorage.getItem("sessionToken")||localStorage.getItem("authToken");console.log("ðŸ”§ [TEMPLATE UPDATE] Session token found:",!!M);const G={"Content-Type":"application/json"};M&&(G.Authorization=`Bearer ${M}`,G["X-Session-Token"]=M,console.log(`ðŸ”§ [TEMPLATE UPDATE] Auth headers set with token: ${M.substring(0,10)}...`));const N=`/api/admin/ai-model-templates/${j}`;console.log(`ðŸ”§ [TEMPLATE UPDATE] Making PUT request to: ${N}`);const le=await fetch(N,{method:"PUT",headers:G,body:JSON.stringify(A)});if(console.log(`ðŸ”§ [TEMPLATE UPDATE] Response status: ${le.status}`),console.log(`ðŸ”§ [TEMPLATE UPDATE] Response ok: ${le.ok}`),!le.ok){console.error(`âŒ [TEMPLATE UPDATE] Request failed with status ${le.status}`);const I=await le.json().catch(()=>({message:"Unknown error"}));throw console.error("âŒ [TEMPLATE UPDATE] Error data:",I),new Error(I.message||`HTTP ${le.status}`)}const ee=await le.json();return console.log("âœ… [TEMPLATE UPDATE] Success:",ee),ee},onSuccess:async j=>{console.log("âœ… [TEMPLATE UPDATE] Success callback executed with data:",j),console.log("âœ… [TEMPLATE UPDATE] Invalidating queries..."),await u.invalidateQueries({queryKey:["/api/admin/ai-model-templates"]}),console.log("âœ… [TEMPLATE UPDATE] Refetching templates manually..."),await x(),console.log("âœ… [TEMPLATE UPDATE] Setting showEditDialog to false..."),r(!1),console.log("âœ… [TEMPLATE UPDATE] Clearing editing template..."),o(null),console.log("âœ… [TEMPLATE UPDATE] Resetting form..."),L.reset(),console.log("âœ… [TEMPLATE UPDATE] Showing success toast..."),c({title:"Template Updated",description:"AI model template has been updated successfully"}),console.log("âœ… [TEMPLATE UPDATE] Success callback completed - modal should close")},onError:j=>{console.error("âŒ [TEMPLATE UPDATE] Error callback executed:",j),console.error("âŒ [TEMPLATE UPDATE] Error message:",j.message),console.error("âŒ [TEMPLATE UPDATE] Full error object:",j),c({title:"Update Failed",description:j.message||"Failed to update AI model template. Please try again."})}}),D=st({mutationFn:async j=>{const A=localStorage.getItem("sessionToken")||localStorage.getItem("authToken"),M={"Content-Type":"application/json"};A&&(M.Authorization=`Bearer ${A}`,M["X-Session-Token"]=A);const G=await fetch(`/api/admin/ai-model-templates/${j}`,{method:"DELETE",headers:M});if(!G.ok){const N=await G.json().catch(()=>({message:"Unknown error"}));throw new Error(N.message||`HTTP ${G.status}`)}return G.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/admin/ai-model-templates"]}),c({title:"Template Deleted",description:"AI model template has been deleted successfully"})},onError:j=>{console.error("Delete template error:",j),c({title:"Deletion Failed",description:j.message||"Failed to delete AI model template. Please try again."})}}),O=j=>{console.log("ðŸš€ Form submission triggered with data:",j),console.log("ðŸš€ Form validation state:",L.formState),console.log("ðŸš€ Form errors:",L.formState.errors);const A=localStorage.getItem("sessionToken"),M=localStorage.getItem("authToken");console.log("ðŸ” Authentication check:",{sessionToken:A?"present":"missing",authToken:M?"present":"missing",user:d?"authenticated":"not authenticated",isSuperUser:h}),s?Y.mutate({id:s.id,...j}):U.mutate(j)},C=j=>{o(j),L.reset({name:j.name,provider:j.provider,modelId:j.modelId,description:j.description||"",contextWindow:j.contextWindow,isEnabled:j.isEnabled,capabilities:Array.isArray(j.capabilities)?j.capabilities:[]}),r(!0)},_=j=>{confirm("Are you sure you want to delete this universal template? This will affect all companies that might use it.")&&D.mutate(j)},k=()=>{l("basic"),L.reset(),o(null)},B=j=>{L.setValue("provider",j)};return g||T?i.jsxs(qe,{title:"AI Model Templates",subtitle:"Loading templates...",children:[i.jsx("style",{children:NZ}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",gap:"24px"},children:[i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"AI Sentinel",style:{width:"80px",height:"80px",objectFit:"contain",animation:"spin 2s linear infinite",filter:"brightness(1.1) saturate(1.3) contrast(1.2)"}})}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#1e293b",margin:"0 0 8px 0"},children:"Loading AI Models"}),i.jsx("p",{style:{fontSize:"16px",color:"#64748b",margin:0},children:"Preparing your custom model configuration..."})]})]})]}):b?i.jsx(qe,{title:"AI Model Templates",subtitle:"Error loading templates",children:i.jsxs("div",{style:{padding:"48px",textAlign:"center",backgroundColor:"#fef2f2",borderRadius:"12px",border:"1px solid #fecaca"},children:[i.jsx("h2",{style:{fontSize:"24px",fontWeight:"600",color:"#991b1b",margin:"0 0 12px 0"},children:"Error Loading Models"}),i.jsx("p",{style:{fontSize:"16px",color:"#7f1d1d",margin:"0 0 16px 0"},children:(S==null?void 0:S.message)||"Failed to load AI models"}),i.jsx("button",{onClick:()=>u.invalidateQueries({queryKey:["/api/ai-models"]}),style:{backgroundColor:"#3b82f6",color:"white",padding:"8px 16px",borderRadius:"6px",border:"none",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Retry"})]})}):i.jsx(qe,{title:"AI Model Templates",subtitle:"Create universal AI model templates for companies to use (no API keys required)",rightContent:i.jsxs(rn,{open:e,onOpenChange:t,children:[i.jsx(Ls,{asChild:!0,children:i.jsxs(me,{style:{backgroundColor:"#3b82f6",color:"white",border:"1px solid #3b82f6",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Tn,{size:20}),"Create Template"]})}),i.jsxs(Qt,{style:{maxWidth:"600px",maxHeight:"90vh",overflowY:"auto"},children:[i.jsxs(Xt,{children:[i.jsx(Zt,{children:"Create New AI Model Template"}),i.jsx(ci,{children:"Create a universal AI model template. No API keys needed - companies configure their own."})]}),i.jsx(TE,{form:L,onSubmit:O,activeTab:a,setActiveTab:l,providers:w,capabilities:SE,handleProviderChange:B,isSubmitting:U.isPending,onCancel:()=>{t(!1),k()}})]})]}),children:i.jsxs("div",{style:{padding:"24px",display:"flex",flexDirection:"column",gap:"32px"},children:[i.jsx("div",{style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"6px",padding:"12px",marginBottom:"16px"},children:i.jsxs("p",{style:{margin:0,fontSize:"14px",color:"#856404"},children:[i.jsx("strong",{children:"Auth Debug:"})," User: ",d?"authenticated":"not authenticated",", SuperUser: ",h?"yes":"no",", Tokens: ",localStorage.getItem("sessionToken")?"session":"none","/",localStorage.getItem("authToken")?"auth":"none"]})}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(400px, 1fr))",gap:"24px"},children:[console.log(`ðŸŽ¨ [TEMPLATES RENDER] Rendering ${y.length} templates:`,y.map(j=>({id:j.id,name:j.name}))),y.length===0?i.jsxs("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"48px",backgroundColor:"#f8fafc",borderRadius:"12px",border:"2px dashed #cbd5e1"},children:[i.jsx(Ti,{style:{width:"48px",height:"48px",color:"#64748b",margin:"0 auto 16px auto"}}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#475569",margin:"0 0 8px 0"},children:"No Templates Created Yet"}),i.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Create your first AI model template to get started"})]}):y.map(j=>{var A,M;return i.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"20px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"16px"},children:[i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:"0 0 4px 0"},children:j.name}),i.jsxs("p",{style:{fontSize:"14px",color:"#64748b",margin:"0 0 8px 0"},children:[j.provider," â€¢ ",j.modelId]}),j.description&&i.jsx("p",{style:{fontSize:"14px",color:"#475569",margin:0,lineHeight:"1.4"},children:j.description})]}),i.jsx("div",{style:{backgroundColor:j.isEnabled?"#10b981":"#ef4444",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"500"},children:j.isEnabled?"Active":"Disabled"})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"16px"},children:[i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"12px",color:"#64748b",margin:"0 0 4px 0"},children:"Context Window"}),i.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b",margin:0},children:((A=j.contextWindow)==null?void 0:A.toLocaleString())||"Not set"})]}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"12px",color:"#64748b",margin:"0 0 4px 0"},children:"Capabilities"}),i.jsxs("p",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b",margin:0},children:[((M=j.capabilities)==null?void 0:M.length)||0," configured"]})]})]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("p",{style:{fontSize:"12px",color:"#64748b",margin:"0 0 4px 0"},children:"Template Type"}),i.jsx("div",{style:{backgroundColor:"#f0f9ff",color:"#0369a1",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",fontWeight:"500"},children:"ðŸŒ Universal Template - Companies configure their own API keys"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"8px"},children:[i.jsxs("button",{onClick:()=>C(j),style:{backgroundColor:"#f8fafc",color:"#475569",padding:"6px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",fontWeight:"500"},children:[i.jsx(Ao,{style:{width:"14px",height:"14px"}}),"Edit"]}),i.jsxs("button",{onClick:()=>_(j.id),style:{backgroundColor:"#fef2f2",color:"#dc2626",padding:"6px 12px",borderRadius:"6px",border:"1px solid #fecaca",fontSize:"14px",display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",fontWeight:"500"},children:[i.jsx(Gn,{style:{width:"14px",height:"14px"}}),"Delete"]})]})]},j.id)})]}),i.jsx(rn,{open:n,onOpenChange:r,children:i.jsxs(Qt,{style:{maxWidth:"600px",maxHeight:"90vh",overflowY:"auto"},children:[i.jsxs(Xt,{children:[i.jsx(Zt,{children:"Edit Universal Template"}),i.jsx(ci,{children:"Modify this universal AI model template. Changes will affect all companies using this template."})]}),i.jsx(TE,{form:L,onSubmit:O,activeTab:a,setActiveTab:l,providers:w,capabilities:SE,handleProviderChange:B,isSubmitting:Y.isPending,onCancel:()=>{r(!1),k()}})]})})]})})}function TE({form:e,onSubmit:t,activeTab:n,setActiveTab:r,providers:s,capabilities:o,handleProviderChange:a,isSubmitting:l,onCancel:c}){return i.jsx(os,{...e,children:i.jsxs("form",{onSubmit:e.handleSubmit(t),style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs(_Z,{value:n,onValueChange:r,style:{width:"100%"},children:[i.jsxs(UN,{style:{display:"grid",width:"100%",gridTemplateColumns:"1fr 1fr"},children:[i.jsx(c0,{value:"basic",children:"Basic Info"}),i.jsx(c0,{value:"advanced",children:"Advanced"})]}),i.jsxs(u0,{value:"basic",style:{marginTop:"16px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Ne,{control:e.control,name:"name",render:({field:u})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Model Name"]}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"e.g., Custom GPT-4",...u,style:{borderColor:u.value?"#10b981":"#dc2626",borderWidth:"2px"}})}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:e.control,name:"provider",render:({field:u})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Provider"]}),i.jsxs(ji,{onValueChange:d=>{u.onChange(d),a(d)},defaultValue:u.value,children:[i.jsx(Re,{children:i.jsx(ai,{style:{borderColor:u.value?"#10b981":"#dc2626",borderWidth:"2px"},children:i.jsx(Ii,{placeholder:"Select provider"})})}),i.jsx(li,{children:s==null?void 0:s.map(d=>i.jsx(Rt,{value:d.value,children:d.label},d.value))})]}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:e.control,name:"modelId",render:({field:u})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Model ID"]}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"e.g., gpt-4",...u,style:{borderColor:u.value?"#10b981":"#dc2626",borderWidth:"2px"}})}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:e.control,name:"contextWindow",render:({field:u})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Context Window"]}),i.jsx(Re,{children:i.jsx(Oe,{type:"number",min:"1",max:"2000000",...u,onChange:d=>u.onChange(parseInt(d.target.value)),style:{borderColor:u.value?"#10b981":"#dc2626",borderWidth:"2px"}})}),i.jsx(Pe,{})]})})]}),i.jsx(Ne,{control:e.control,name:"description",render:({field:u})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{color:"#64748b",fontWeight:"500",fontSize:"14px"},children:"Description (Optional)"}),i.jsx(Re,{children:i.jsx(Ni,{placeholder:"Describe this model's capabilities and use cases...",...u,style:{borderColor:"#e2e8f0",borderWidth:"1px"}})}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:e.control,name:"isEnabled",render:({field:u})=>i.jsxs(je,{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Re,{children:i.jsx(Oo,{checked:u.value,onCheckedChange:u.onChange})}),i.jsx(Ie,{style:{margin:0},children:"Enable this model"})]})})]}),i.jsx(u0,{value:"advanced",style:{marginTop:"16px"},children:i.jsx("div",{style:{display:"grid",gap:"16px"},children:i.jsx(Ne,{control:e.control,name:"capabilities",render:({field:u})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{color:"#64748b",fontWeight:"500",fontSize:"14px"},children:"Capabilities (Optional)"}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px",marginTop:"8px"},children:o.map(d=>{var p;return i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:((p=u.value)==null?void 0:p.includes(d))||!1,onChange:f=>{const h=u.value||[];f.target.checked?u.onChange([...h,d]):u.onChange(h.filter(y=>y!==d))},style:{marginRight:"4px"}}),i.jsx("span",{style:{fontSize:"14px",textTransform:"capitalize"},children:d.replace("-"," ")})]},d)})}),i.jsx(Pe,{})]})})})})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",paddingTop:"16px"},children:[i.jsx("button",{type:"button",onClick:c,style:{backgroundColor:"#f8fafc",color:"#475569",padding:"8px 16px",borderRadius:"6px",border:"1px solid #e2e8f0",cursor:"pointer",fontSize:"14px",fontWeight:"500"},children:"Cancel"}),i.jsx("button",{type:"submit",disabled:l,onClick:u=>{console.log("ðŸ”¥ Button clicked - triggering form submission"),u.preventDefault(),e.handleSubmit(t)()},style:{backgroundColor:l?"#9ca3af":"#3b82f6",color:"white",padding:"8px 16px",borderRadius:"6px",border:"none",cursor:l?"not-allowed":"pointer",fontSize:"14px",fontWeight:"500"},children:l?"Processing...":"Save Template"})]})]})})}const ne=Symbol.for("drizzle:entityKind");function vn(e,t){if(!e||typeof e!="object")return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,ne))throw new Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=Object.getPrototypeOf(e).constructor;if(n)for(;n;){if(ne in n&&n[ne]===t[ne])return!0;n=Object.getPrototypeOf(n)}return!1}var HE;HE=ne;class rc{constructor(t,n){V(this,"name");V(this,"keyAsName");V(this,"primary");V(this,"notNull");V(this,"default");V(this,"defaultFn");V(this,"onUpdateFn");V(this,"hasDefault");V(this,"isUnique");V(this,"uniqueName");V(this,"uniqueType");V(this,"dataType");V(this,"columnType");V(this,"enumValues");V(this,"generated");V(this,"generatedIdentity");V(this,"config");this.table=t,this.config=n,this.name=n.name,this.keyAsName=n.keyAsName,this.notNull=n.notNull,this.default=n.default,this.defaultFn=n.defaultFn,this.onUpdateFn=n.onUpdateFn,this.hasDefault=n.hasDefault,this.primary=n.primaryKey,this.isUnique=n.isUnique,this.uniqueName=n.uniqueName,this.uniqueType=n.uniqueType,this.dataType=n.dataType,this.columnType=n.columnType,this.generated=n.generated,this.generatedIdentity=n.generatedIdentity}mapFromDriverValue(t){return t}mapToDriverValue(t){return t}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}V(rc,HE,"Column");var WE;WE=ne;class HN{constructor(t,n,r){V(this,"config");V(this,"$default",this.$defaultFn);V(this,"$onUpdate",this.$onUpdateFn);this.config={name:t,keyAsName:t==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:n,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(t){return this.config.default=t,this.config.hasDefault=!0,this}$defaultFn(t){return this.config.defaultFn=t,this.config.hasDefault=!0,this}$onUpdateFn(t){return this.config.onUpdateFn=t,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(t){this.config.name===""&&(this.config.name=t)}}V(HN,WE,"ColumnBuilder");const Cl=Symbol.for("drizzle:Name");var VE;VE=ne;class WN{constructor(t,n){V(this,"reference");V(this,"_onUpdate","no action");V(this,"_onDelete","no action");this.reference=()=>{const{name:r,columns:s,foreignColumns:o}=t();return{name:r,columns:s,foreignTable:o[0].table,foreignColumns:o}},n&&(this._onUpdate=n.onUpdate,this._onDelete=n.onDelete)}onUpdate(t){return this._onUpdate=t===void 0?"no action":t,this}onDelete(t){return this._onDelete=t===void 0?"no action":t,this}build(t){return new VN(t,this)}}V(WN,VE,"PgForeignKeyBuilder");var $E;$E=ne;class VN{constructor(t,n){V(this,"reference");V(this,"onUpdate");V(this,"onDelete");this.table=t,this.reference=n.reference,this.onUpdate=n._onUpdate,this.onDelete=n._onDelete}getName(){const{name:t,columns:n,foreignColumns:r}=this.reference(),s=n.map(l=>l.name),o=r.map(l=>l.name),a=[this.table[Cl],...s,r[0].table[Cl],...o];return t??`${a.join("_")}_fk`}}V(VN,$E,"PgForeignKey");function OZ(e,...t){return e(...t)}function $N(e){return new KN(e)}function qN(e,t){return`${e[Cl]}_${t.join("_")}_unique`}var qE;qE=ne;class YN{constructor(t,n){V(this,"columns");V(this,"nullsNotDistinctConfig",!1);this.name=n,this.columns=t}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(t){return new GN(t,this.columns,this.nullsNotDistinctConfig,this.name)}}V(YN,qE,"PgUniqueConstraintBuilder");var YE;YE=ne;class KN{constructor(t){V(this,"name");this.name=t}on(...t){return new YN(t,this.name)}}V(KN,YE,"PgUniqueOnConstraintBuilder");var KE;KE=ne;class GN{constructor(t,n,r,s){V(this,"columns");V(this,"name");V(this,"nullsNotDistinct",!1);this.table=t,this.columns=n,this.name=s??qN(this.table,this.columns.map(o=>o.name)),this.nullsNotDistinct=r}getName(){return this.name}}V(GN,KE,"PgUniqueConstraint");function wE(e,t,n){for(let r=t;r<e.length;r++){const s=e[r];if(s==="\\"){r++;continue}if(s==='"')return[e.slice(t,r).replace(/\\/g,""),r+1];if(!n&&(s===","||s==="}"))return[e.slice(t,r).replace(/\\/g,""),r]}return[e.slice(t).replace(/\\/g,""),e.length]}function QN(e,t=0){const n=[];let r=t,s=!1;for(;r<e.length;){const o=e[r];if(o===","){(s||r===t)&&n.push(""),s=!0,r++;continue}if(s=!1,o==="\\"){r+=2;continue}if(o==='"'){const[c,u]=wE(e,r+1,!0);n.push(c),r=u;continue}if(o==="}")return[n,r+1];if(o==="{"){const[c,u]=QN(e,r+1);n.push(c),r=u;continue}const[a,l]=wE(e,r,!1);n.push(a),r=l}return[n,r]}function LZ(e){const[t]=QN(e,1);return t}function XN(e){return`{${e.map(t=>Array.isArray(t)?XN(t):typeof t=="string"?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}var GE,QE;class yt extends(QE=HN,GE=ne,QE){constructor(){super(...arguments);V(this,"foreignKeyConfigs",[])}array(n){return new JN(this.config.name,this,n)}references(n,r={}){return this.foreignKeyConfigs.push({ref:n,actions:r}),this}unique(n,r){return this.config.isUnique=!0,this.config.uniqueName=n,this.config.uniqueType=r==null?void 0:r.nulls,this}generatedAlwaysAs(n){return this.config.generated={as:n,type:"always",mode:"stored"},this}buildForeignKeys(n,r){return this.foreignKeyConfigs.map(({ref:s,actions:o})=>OZ((a,l)=>{const c=new WN(()=>{const u=a();return{columns:[n],foreignColumns:[u]}});return l.onUpdate&&c.onUpdate(l.onUpdate),l.onDelete&&c.onDelete(l.onDelete),c.build(r)},s,o))}buildExtraConfigColumn(n){return new ZN(n,this.config)}}V(yt,GE,"PgColumnBuilder");var XE,ZE;class nt extends(ZE=rc,XE=ne,ZE){constructor(t,n){n.uniqueName||(n.uniqueName=qN(t,[n.name])),super(t,n),this.table=t}}V(nt,XE,"PgColumn");var JE,eS;class ZN extends(eS=nt,JE=ne,eS){constructor(){super(...arguments);V(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass});V(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(n){return this.indexConfig.opClass=n,this}}V(ZN,JE,"ExtraConfigColumn");var tS;tS=ne;class Op{constructor(t,n,r,s){V(this,"name");V(this,"keyAsName");V(this,"type");V(this,"indexConfig");this.name=t,this.keyAsName=n,this.type=r,this.indexConfig=s}}V(Op,tS,"IndexedColumn");var nS,rS;class JN extends(rS=yt,nS=ne,rS){constructor(t,n,r){super(t,"array","PgArray"),this.config.baseBuilder=n,this.config.size=r}build(t){const n=this.config.baseBuilder.build(t);return new d0(t,this.config,n)}}V(JN,nS,"PgArrayBuilder");var iS,sS;const Wf=class Wf extends(sS=nt,iS=ne,sS){constructor(n,r,s,o){super(n,r);V(this,"size");this.baseColumn=s,this.range=o,this.size=r.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(n){return typeof n=="string"&&(n=LZ(n)),n.map(r=>this.baseColumn.mapFromDriverValue(r))}mapToDriverValue(n,r=!1){const s=n.map(o=>o===null?null:vn(this.baseColumn,Wf)?this.baseColumn.mapToDriverValue(o,!0):this.baseColumn.mapToDriverValue(o));return r?s:XN(s)}};V(Wf,iS,"PgArray");let d0=Wf;const CE=Symbol.for("drizzle:isPgEnum");function MZ(e){return!!e&&typeof e=="function"&&CE in e&&e[CE]===!0}var oS;oS=ne;class k1{constructor(t,n,r,s=!1){this._={brand:"Subquery",sql:t,selectedFields:n,alias:r,isWith:s}}}V(k1,oS,"Subquery");const FZ={startActiveSpan(e,t){return t()}},kl=Symbol.for("drizzle:ViewBaseConfig"),lg=Symbol.for("drizzle:Schema"),kE=Symbol.for("drizzle:Columns"),AE=Symbol.for("drizzle:ExtraConfigColumns"),cg=Symbol.for("drizzle:OriginalName"),ug=Symbol.for("drizzle:BaseName"),Bf=Symbol.for("drizzle:IsAlias"),jE=Symbol.for("drizzle:ExtraConfigBuilder"),eR=Symbol.for("drizzle:IsDrizzleTable");var aS,lS,cS,uS,dS,pS,fS,hS,mS,gS;gS=ne,mS=Cl,hS=cg,fS=lg,pS=kE,dS=AE,uS=ug,cS=Bf,lS=eR,aS=jE;class cr{constructor(t,n,r){V(this,mS);V(this,hS);V(this,fS);V(this,pS);V(this,dS);V(this,uS);V(this,cS,!1);V(this,lS,!0);V(this,aS);this[Cl]=this[cg]=t,this[lg]=n,this[ug]=r}}V(cr,gS,"Table"),V(cr,"Symbol",{Name:Cl,Schema:lg,OriginalName:cg,Columns:kE,ExtraConfigColumns:AE,BaseName:ug,IsAlias:Bf,ExtraConfigBuilder:jE});function tR(e){return typeof e=="object"&&e!==null&&eR in e}function BZ(e){return e!=null&&typeof e.getSQL=="function"}function zZ(e){var n;const t={sql:"",params:[]};for(const r of e)t.sql+=r.sql,t.params.push(...r.params),(n=r.typings)!=null&&n.length&&(t.typings||(t.typings=[]),t.typings.push(...r.typings));return t}var xS;xS=ne;class Xr{constructor(t){V(this,"value");this.value=Array.isArray(t)?t:[t]}getSQL(){return new pn([this])}}V(Xr,xS,"StringChunk");var yS;yS=ne;const Ko=class Ko{constructor(t){V(this,"decoder",nR);V(this,"shouldInlineParams",!1);this.queryChunks=t}append(t){return this.queryChunks.push(...t.queryChunks),this}toQuery(t){return FZ.startActiveSpan("drizzle.buildSQL",n=>{const r=this.buildQueryFromSourceParams(this.queryChunks,t);return n==null||n.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(t,n){const r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{casing:s,escapeName:o,escapeParam:a,prepareTyping:l,inlineParams:c,paramStartIndex:u}=r;return zZ(t.map(d=>{var p;if(vn(d,Xr))return{sql:d.value.join(""),params:[]};if(vn(d,zf))return{sql:o(d.value),params:[]};if(d===void 0)return{sql:"",params:[]};if(Array.isArray(d)){const f=[new Xr("(")];for(const[h,y]of d.entries())f.push(y),h<d.length-1&&f.push(new Xr(", "));return f.push(new Xr(")")),this.buildQueryFromSourceParams(f,r)}if(vn(d,Ko))return this.buildQueryFromSourceParams(d.queryChunks,{...r,inlineParams:c||d.shouldInlineParams});if(vn(d,cr)){const f=d[cr.Symbol.Schema],h=d[cr.Symbol.Name];return{sql:f===void 0||d[Bf]?o(h):o(f)+"."+o(h),params:[]}}if(vn(d,rc)){const f=s.getColumnCasing(d);if(n.invokeSource==="indexes")return{sql:o(f),params:[]};const h=d.table[cr.Symbol.Schema];return{sql:d.table[Bf]||h===void 0?o(d.table[cr.Symbol.Name])+"."+o(f):o(h)+"."+o(d.table[cr.Symbol.Name])+"."+o(f),params:[]}}if(vn(d,sR)){const f=d[kl].schema,h=d[kl].name;return{sql:f===void 0||d[kl].isAlias?o(h):o(f)+"."+o(h),params:[]}}if(vn(d,A1)){if(vn(d.value,Hf))return{sql:a(u.value++,d),params:[d],typings:["none"]};const f=d.value===null?null:d.encoder.mapToDriverValue(d.value);if(vn(f,Ko))return this.buildQueryFromSourceParams([f],r);if(c)return{sql:this.mapInlineParam(f,r),params:[]};let h=["none"];return l&&(h=[l(d.encoder)]),{sql:a(u.value++,f),params:[f],typings:h}}return vn(d,Hf)?{sql:a(u.value++,d),params:[d],typings:["none"]}:vn(d,Ko.Aliased)&&d.fieldAlias!==void 0?{sql:o(d.fieldAlias),params:[]}:vn(d,k1)?d._.isWith?{sql:o(d._.alias),params:[]}:this.buildQueryFromSourceParams([new Xr("("),d._.sql,new Xr(") "),new zf(d._.alias)],r):MZ(d)?d.schema?{sql:o(d.schema)+"."+o(d.enumName),params:[]}:{sql:o(d.enumName),params:[]}:BZ(d)?(p=d.shouldOmitSQLParens)!=null&&p.call(d)?this.buildQueryFromSourceParams([d.getSQL()],r):this.buildQueryFromSourceParams([new Xr("("),d.getSQL(),new Xr(")")],r):c?{sql:this.mapInlineParam(d,r),params:[]}:{sql:a(u.value++,d),params:[d],typings:["none"]}}))}mapInlineParam(t,{escapeString:n}){if(t===null)return"null";if(typeof t=="number"||typeof t=="boolean")return t.toString();if(typeof t=="string")return n(t);if(typeof t=="object"){const r=t.toString();return n(r==="[object Object]"?JSON.stringify(t):r)}throw new Error("Unexpected param value: "+t)}getSQL(){return this}as(t){return t===void 0?this:new Ko.Aliased(this,t)}mapWith(t){return this.decoder=typeof t=="function"?{mapFromDriverValue:t}:t,this}inlineParams(){return this.shouldInlineParams=!0,this}if(t){return t?this:void 0}};V(Ko,yS,"SQL");let pn=Ko;var bS;bS=ne;class zf{constructor(t){V(this,"brand");this.value=t}getSQL(){return new pn([this])}}V(zf,bS,"Name");const nR={mapFromDriverValue:e=>e},rR={mapToDriverValue:e=>e};({...nR,...rR});var vS;vS=ne;class A1{constructor(t,n=rR){V(this,"brand");this.value=t,this.encoder=n}getSQL(){return new pn([this])}}V(A1,vS,"Param");function Uf(e,...t){const n=[];(t.length>0||e.length>0&&e[0]!=="")&&n.push(new Xr(e[0]));for(const[r,s]of t.entries())n.push(s,new Xr(e[r+1]));return new pn(n)}(e=>{function t(){return new pn([])}e.empty=t;function n(c){return new pn(c)}e.fromList=n;function r(c){return new pn([new Xr(c)])}e.raw=r;function s(c,u){const d=[];for(const[p,f]of c.entries())p>0&&u!==void 0&&d.push(u),d.push(f);return new pn(d)}e.join=s;function o(c){return new zf(c)}e.identifier=o;function a(c){return new Hf(c)}e.placeholder=a;function l(c,u){return new A1(c,u)}e.param=l})(Uf||(Uf={}));(e=>{var n;n=ne;const r=class r{constructor(o,a){V(this,"isSelectionField",!1);this.sql=o,this.fieldAlias=a}getSQL(){return this.sql}clone(){return new r(this.sql,this.fieldAlias)}};V(r,n,"SQL.Aliased");let t=r;e.Aliased=t})(pn||(pn={}));var ES;ES=ne;class Hf{constructor(t){this.name=t}getSQL(){return new pn([this])}}V(Hf,ES,"Placeholder");const iR=Symbol.for("drizzle:IsDrizzleView");var SS,TS,wS;wS=ne,TS=kl,SS=iR;class sR{constructor({name:t,schema:n,selectedFields:r,query:s}){V(this,TS);V(this,SS,!0);this[kl]={name:t,originalName:t,schema:n,selectedFields:r,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new pn([this])}}V(sR,wS,"View");function UZ(e){return typeof e=="object"&&e!==null&&iR in e}rc.prototype.getSQL=function(){return new pn([this])};cr.prototype.getSQL=function(){return new pn([this])};k1.prototype.getSQL=function(){return new pn([this])};function HZ(e){return e[cr.Symbol.Columns]}function WZ(e){return e[kl].selectedFields}function Pn(e,t){return{name:typeof e=="string"&&e.length>0?e:"",config:typeof e=="object"?e:t}}var CS,kS;class _d extends(kS=yt,CS=ne,kS){generatedAlwaysAsIdentity(t){if(t){const{name:n,...r}=t;this.config.generatedIdentity={type:"always",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(t){if(t){const{name:n,...r}=t;this.config.generatedIdentity={type:"byDefault",sequenceName:n,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}V(_d,CS,"PgIntColumnBaseBuilder");var AS,jS;class oR extends(jS=_d,AS=ne,jS){constructor(t){super(t,"number","PgBigInt53")}build(t){return new aR(t,this.config)}}V(oR,AS,"PgBigInt53Builder");var IS,_S;class aR extends(_S=nt,IS=ne,_S){getSQLType(){return"bigint"}mapFromDriverValue(t){return typeof t=="number"?t:Number(t)}}V(aR,IS,"PgBigInt53");var NS,RS;class lR extends(RS=_d,NS=ne,RS){constructor(t){super(t,"bigint","PgBigInt64")}build(t){return new cR(t,this.config)}}V(lR,NS,"PgBigInt64Builder");var DS,PS;class cR extends(PS=nt,DS=ne,PS){getSQLType(){return"bigint"}mapFromDriverValue(t){return BigInt(t)}}V(cR,DS,"PgBigInt64");function VZ(e,t){const{name:n,config:r}=Pn(e,t);return r.mode==="number"?new oR(n):new lR(n)}var OS,LS;class uR extends(LS=yt,OS=ne,LS){constructor(t){super(t,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(t){return new dR(t,this.config)}}V(uR,OS,"PgBigSerial53Builder");var MS,FS;class dR extends(FS=nt,MS=ne,FS){getSQLType(){return"bigserial"}mapFromDriverValue(t){return typeof t=="number"?t:Number(t)}}V(dR,MS,"PgBigSerial53");var BS,zS;class pR extends(zS=yt,BS=ne,zS){constructor(t){super(t,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(t){return new fR(t,this.config)}}V(pR,BS,"PgBigSerial64Builder");var US,HS;class fR extends(HS=nt,US=ne,HS){getSQLType(){return"bigserial"}mapFromDriverValue(t){return BigInt(t)}}V(fR,US,"PgBigSerial64");function $Z(e,t){const{name:n,config:r}=Pn(e,t);return r.mode==="number"?new uR(n):new pR(n)}var WS,VS;class hR extends(VS=yt,WS=ne,VS){constructor(t){super(t,"boolean","PgBoolean")}build(t){return new mR(t,this.config)}}V(hR,WS,"PgBooleanBuilder");var $S,qS;class mR extends(qS=nt,$S=ne,qS){getSQLType(){return"boolean"}}V(mR,$S,"PgBoolean");function Dt(e){return new hR(e??"")}var YS,KS;class gR extends(KS=yt,YS=ne,KS){constructor(t,n){super(t,"string","PgChar"),this.config.length=n.length,this.config.enumValues=n.enum}build(t){return new xR(t,this.config)}}V(gR,YS,"PgCharBuilder");var GS,QS;class xR extends(QS=nt,GS=ne,QS){constructor(){super(...arguments);V(this,"length",this.config.length);V(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}V(xR,GS,"PgChar");function qZ(e,t={}){const{name:n,config:r}=Pn(e,t);return new gR(n,r)}var XS,ZS;class yR extends(ZS=yt,XS=ne,ZS){constructor(t){super(t,"string","PgCidr")}build(t){return new bR(t,this.config)}}V(yR,XS,"PgCidrBuilder");var JS,eT;class bR extends(eT=nt,JS=ne,eT){getSQLType(){return"cidr"}}V(bR,JS,"PgCidr");function YZ(e){return new yR(e??"")}var tT,nT;class vR extends(nT=yt,tT=ne,nT){constructor(t,n,r){super(t,"custom","PgCustomColumn"),this.config.fieldConfig=n,this.config.customTypeParams=r}build(t){return new ER(t,this.config)}}V(vR,tT,"PgCustomColumnBuilder");var rT,iT;class ER extends(iT=nt,rT=ne,iT){constructor(n,r){super(n,r);V(this,"sqlName");V(this,"mapTo");V(this,"mapFrom");this.sqlName=r.customTypeParams.dataType(r.fieldConfig),this.mapTo=r.customTypeParams.toDriver,this.mapFrom=r.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(n){return typeof this.mapFrom=="function"?this.mapFrom(n):n}mapToDriverValue(n){return typeof this.mapTo=="function"?this.mapTo(n):n}}V(ER,rT,"PgCustomColumn");function KZ(e){return(t,n)=>{const{name:r,config:s}=Pn(t,n);return new vR(r,s,e)}}var sT,oT;class bc extends(oT=yt,sT=ne,oT){defaultNow(){return this.default(Uf`now()`)}}V(bc,sT,"PgDateColumnBaseBuilder");var aT,lT;class SR extends(lT=bc,aT=ne,lT){constructor(t){super(t,"date","PgDate")}build(t){return new TR(t,this.config)}}V(SR,aT,"PgDateBuilder");var cT,uT;class TR extends(uT=nt,cT=ne,uT){getSQLType(){return"date"}mapFromDriverValue(t){return new Date(t)}mapToDriverValue(t){return t.toISOString()}}V(TR,cT,"PgDate");var dT,pT;class wR extends(pT=bc,dT=ne,pT){constructor(t){super(t,"string","PgDateString")}build(t){return new CR(t,this.config)}}V(wR,dT,"PgDateStringBuilder");var fT,hT;class CR extends(hT=nt,fT=ne,hT){getSQLType(){return"date"}}V(CR,fT,"PgDateString");function GZ(e,t){const{name:n,config:r}=Pn(e,t);return(r==null?void 0:r.mode)==="date"?new SR(n):new wR(n)}var mT,gT;class kR extends(gT=yt,mT=ne,gT){constructor(t){super(t,"number","PgDoublePrecision")}build(t){return new AR(t,this.config)}}V(kR,mT,"PgDoublePrecisionBuilder");var xT,yT;class AR extends(yT=nt,xT=ne,yT){getSQLType(){return"double precision"}mapFromDriverValue(t){return typeof t=="string"?Number.parseFloat(t):t}}V(AR,xT,"PgDoublePrecision");function QZ(e){return new kR(e??"")}var bT,vT;class jR extends(vT=yt,bT=ne,vT){constructor(t){super(t,"string","PgInet")}build(t){return new IR(t,this.config)}}V(jR,bT,"PgInetBuilder");var ET,ST;class IR extends(ST=nt,ET=ne,ST){getSQLType(){return"inet"}}V(IR,ET,"PgInet");function XZ(e){return new jR(e??"")}var TT,wT;class _R extends(wT=_d,TT=ne,wT){constructor(t){super(t,"number","PgInteger")}build(t){return new NR(t,this.config)}}V(_R,TT,"PgIntegerBuilder");var CT,kT;class NR extends(kT=nt,CT=ne,kT){getSQLType(){return"integer"}mapFromDriverValue(t){return typeof t=="string"?Number.parseInt(t):t}}V(NR,CT,"PgInteger");function _e(e){return new _R(e??"")}var AT,jT;class RR extends(jT=yt,AT=ne,jT){constructor(t,n){super(t,"string","PgInterval"),this.config.intervalConfig=n}build(t){return new DR(t,this.config)}}V(RR,AT,"PgIntervalBuilder");var IT,_T;class DR extends(_T=nt,IT=ne,_T){constructor(){super(...arguments);V(this,"fields",this.config.intervalConfig.fields);V(this,"precision",this.config.intervalConfig.precision)}getSQLType(){const n=this.fields?` ${this.fields}`:"",r=this.precision?`(${this.precision})`:"";return`interval${n}${r}`}}V(DR,IT,"PgInterval");function ZZ(e,t={}){const{name:n,config:r}=Pn(e,t);return new RR(n,r)}var NT,RT;class PR extends(RT=yt,NT=ne,RT){constructor(t){super(t,"json","PgJson")}build(t){return new OR(t,this.config)}}V(PR,NT,"PgJsonBuilder");var DT,PT;class OR extends(PT=nt,DT=ne,PT){constructor(t,n){super(t,n)}getSQLType(){return"json"}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t}}V(OR,DT,"PgJson");function JZ(e){return new PR(e??"")}var OT,LT;class LR extends(LT=yt,OT=ne,LT){constructor(t){super(t,"json","PgJsonb")}build(t){return new MR(t,this.config)}}V(LR,OT,"PgJsonbBuilder");var MT,FT;class MR extends(FT=nt,MT=ne,FT){constructor(t,n){super(t,n)}getSQLType(){return"jsonb"}mapToDriverValue(t){return JSON.stringify(t)}mapFromDriverValue(t){if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t}}V(MR,MT,"PgJsonb");function ui(e){return new LR(e??"")}var BT,zT;class FR extends(zT=yt,BT=ne,zT){constructor(t){super(t,"array","PgLine")}build(t){return new BR(t,this.config)}}V(FR,BT,"PgLineBuilder");var UT,HT;class BR extends(HT=nt,UT=ne,HT){getSQLType(){return"line"}mapFromDriverValue(t){const[n,r,s]=t.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r),Number.parseFloat(s)]}mapToDriverValue(t){return`{${t[0]},${t[1]},${t[2]}}`}}V(BR,UT,"PgLine");var WT,VT;class zR extends(VT=yt,WT=ne,VT){constructor(t){super(t,"json","PgLineABC")}build(t){return new UR(t,this.config)}}V(zR,WT,"PgLineABCBuilder");var $T,qT;class UR extends(qT=nt,$T=ne,qT){getSQLType(){return"line"}mapFromDriverValue(t){const[n,r,s]=t.slice(1,-1).split(",");return{a:Number.parseFloat(n),b:Number.parseFloat(r),c:Number.parseFloat(s)}}mapToDriverValue(t){return`{${t.a},${t.b},${t.c}}`}}V(UR,$T,"PgLineABC");function eJ(e,t){const{name:n,config:r}=Pn(e,t);return!(r!=null&&r.mode)||r.mode==="tuple"?new FR(n):new zR(n)}var YT,KT;class HR extends(KT=yt,YT=ne,KT){constructor(t){super(t,"string","PgMacaddr")}build(t){return new WR(t,this.config)}}V(HR,YT,"PgMacaddrBuilder");var GT,QT;class WR extends(QT=nt,GT=ne,QT){getSQLType(){return"macaddr"}}V(WR,GT,"PgMacaddr");function tJ(e){return new HR(e??"")}var XT,ZT;class VR extends(ZT=yt,XT=ne,ZT){constructor(t){super(t,"string","PgMacaddr8")}build(t){return new $R(t,this.config)}}V(VR,XT,"PgMacaddr8Builder");var JT,ew;class $R extends(ew=nt,JT=ne,ew){getSQLType(){return"macaddr8"}}V($R,JT,"PgMacaddr8");function nJ(e){return new VR(e??"")}var tw,nw;class qR extends(nw=yt,tw=ne,nw){constructor(t,n,r){super(t,"string","PgNumeric"),this.config.precision=n,this.config.scale=r}build(t){return new YR(t,this.config)}}V(qR,tw,"PgNumericBuilder");var rw,iw;class YR extends(iw=nt,rw=ne,iw){constructor(n,r){super(n,r);V(this,"precision");V(this,"scale");this.precision=r.precision,this.scale=r.scale}getSQLType(){return this.precision!==void 0&&this.scale!==void 0?`numeric(${this.precision}, ${this.scale})`:this.precision===void 0?"numeric":`numeric(${this.precision})`}}V(YR,rw,"PgNumeric");function rJ(e,t){const{name:n,config:r}=Pn(e,t);return new qR(n,r==null?void 0:r.precision,r==null?void 0:r.scale)}var sw,ow;class KR extends(ow=yt,sw=ne,ow){constructor(t){super(t,"array","PgPointTuple")}build(t){return new GR(t,this.config)}}V(KR,sw,"PgPointTupleBuilder");var aw,lw;class GR extends(lw=nt,aw=ne,lw){getSQLType(){return"point"}mapFromDriverValue(t){if(typeof t=="string"){const[n,r]=t.slice(1,-1).split(",");return[Number.parseFloat(n),Number.parseFloat(r)]}return[t.x,t.y]}mapToDriverValue(t){return`(${t[0]},${t[1]})`}}V(GR,aw,"PgPointTuple");var cw,uw;class QR extends(uw=yt,cw=ne,uw){constructor(t){super(t,"json","PgPointObject")}build(t){return new XR(t,this.config)}}V(QR,cw,"PgPointObjectBuilder");var dw,pw;class XR extends(pw=nt,dw=ne,pw){getSQLType(){return"point"}mapFromDriverValue(t){if(typeof t=="string"){const[n,r]=t.slice(1,-1).split(",");return{x:Number.parseFloat(n),y:Number.parseFloat(r)}}return t}mapToDriverValue(t){return`(${t.x},${t.y})`}}V(XR,dw,"PgPointObject");function iJ(e,t){const{name:n,config:r}=Pn(e,t);return!(r!=null&&r.mode)||r.mode==="tuple"?new KR(n):new QR(n)}function sJ(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(Number.parseInt(e.slice(n,n+2),16));return new Uint8Array(t)}function IE(e,t){const n=new ArrayBuffer(8),r=new DataView(n);for(let s=0;s<8;s++)r.setUint8(s,e[t+s]);return r.getFloat64(0,!0)}function ZR(e){const t=sJ(e);let n=0;const r=t[n];n+=1;const s=new DataView(t.buffer),o=s.getUint32(n,r===1);if(n+=4,o&536870912&&(s.getUint32(n,r===1),n+=4),(o&65535)===1){const a=IE(t,n);n+=8;const l=IE(t,n);return n+=8,[a,l]}throw new Error("Unsupported geometry type")}var fw,hw;class JR extends(hw=yt,fw=ne,hw){constructor(t){super(t,"array","PgGeometry")}build(t){return new e8(t,this.config)}}V(JR,fw,"PgGeometryBuilder");var mw,gw;class e8 extends(gw=nt,mw=ne,gw){getSQLType(){return"geometry(point)"}mapFromDriverValue(t){return ZR(t)}mapToDriverValue(t){return`point(${t[0]} ${t[1]})`}}V(e8,mw,"PgGeometry");var xw,yw;class t8 extends(yw=yt,xw=ne,yw){constructor(t){super(t,"json","PgGeometryObject")}build(t){return new n8(t,this.config)}}V(t8,xw,"PgGeometryObjectBuilder");var bw,vw;class n8 extends(vw=nt,bw=ne,vw){getSQLType(){return"geometry(point)"}mapFromDriverValue(t){const n=ZR(t);return{x:n[0],y:n[1]}}mapToDriverValue(t){return`point(${t.x} ${t.y})`}}V(n8,bw,"PgGeometryObject");function oJ(e,t){const{name:n,config:r}=Pn(e,t);return!(r!=null&&r.mode)||r.mode==="tuple"?new JR(n):new t8(n)}var Ew,Sw;class r8 extends(Sw=yt,Ew=ne,Sw){constructor(t,n){super(t,"number","PgReal"),this.config.length=n}build(t){return new i8(t,this.config)}}V(r8,Ew,"PgRealBuilder");var Tw,ww;class i8 extends(ww=nt,Tw=ne,ww){constructor(n,r){super(n,r);V(this,"mapFromDriverValue",n=>typeof n=="string"?Number.parseFloat(n):n)}getSQLType(){return"real"}}V(i8,Tw,"PgReal");function Vh(e){return new r8(e??"")}var Cw,kw;class s8 extends(kw=yt,Cw=ne,kw){constructor(t){super(t,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(t){return new o8(t,this.config)}}V(s8,Cw,"PgSerialBuilder");var Aw,jw;class o8 extends(jw=nt,Aw=ne,jw){getSQLType(){return"serial"}}V(o8,Aw,"PgSerial");function Ft(e){return new s8(e??"")}var Iw,_w;class a8 extends(_w=_d,Iw=ne,_w){constructor(t){super(t,"number","PgSmallInt")}build(t){return new l8(t,this.config)}}V(a8,Iw,"PgSmallIntBuilder");var Nw,Rw;class l8 extends(Rw=nt,Nw=ne,Rw){constructor(){super(...arguments);V(this,"mapFromDriverValue",n=>typeof n=="string"?Number(n):n)}getSQLType(){return"smallint"}}V(l8,Nw,"PgSmallInt");function aJ(e){return new a8(e??"")}var Dw,Pw;class c8 extends(Pw=yt,Dw=ne,Pw){constructor(t){super(t,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(t){return new u8(t,this.config)}}V(c8,Dw,"PgSmallSerialBuilder");var Ow,Lw;class u8 extends(Lw=nt,Ow=ne,Lw){getSQLType(){return"smallserial"}}V(u8,Ow,"PgSmallSerial");function lJ(e){return new c8(e??"")}var Mw,Fw;class d8 extends(Fw=yt,Mw=ne,Fw){constructor(t,n){super(t,"string","PgText"),this.config.enumValues=n.enum}build(t){return new p8(t,this.config)}}V(d8,Mw,"PgTextBuilder");var Bw,zw;class p8 extends(zw=nt,Bw=ne,zw){constructor(){super(...arguments);V(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}V(p8,Bw,"PgText");function on(e,t={}){const{name:n,config:r}=Pn(e,t);return new d8(n,r)}var Uw,Hw;class f8 extends(Hw=bc,Uw=ne,Hw){constructor(t,n,r){super(t,"string","PgTime"),this.withTimezone=n,this.precision=r,this.config.withTimezone=n,this.config.precision=r}build(t){return new h8(t,this.config)}}V(f8,Uw,"PgTimeBuilder");var Ww,Vw;class h8 extends(Vw=nt,Ww=ne,Vw){constructor(n,r){super(n,r);V(this,"withTimezone");V(this,"precision");this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}V(h8,Ww,"PgTime");function cJ(e,t={}){const{name:n,config:r}=Pn(e,t);return new f8(n,r.withTimezone??!1,r.precision)}var $w,qw;class m8 extends(qw=bc,$w=ne,qw){constructor(t,n,r){super(t,"date","PgTimestamp"),this.config.withTimezone=n,this.config.precision=r}build(t){return new g8(t,this.config)}}V(m8,$w,"PgTimestampBuilder");var Yw,Kw;class g8 extends(Kw=nt,Yw=ne,Kw){constructor(n,r){super(n,r);V(this,"withTimezone");V(this,"precision");V(this,"mapFromDriverValue",n=>new Date(this.withTimezone?n:n+"+0000"));V(this,"mapToDriverValue",n=>n.toISOString());this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}V(g8,Yw,"PgTimestamp");var Gw,Qw;class x8 extends(Qw=bc,Gw=ne,Qw){constructor(t,n,r){super(t,"string","PgTimestampString"),this.config.withTimezone=n,this.config.precision=r}build(t){return new y8(t,this.config)}}V(x8,Gw,"PgTimestampStringBuilder");var Xw,Zw;class y8 extends(Zw=nt,Xw=ne,Zw){constructor(n,r){super(n,r);V(this,"withTimezone");V(this,"precision");this.withTimezone=r.withTimezone,this.precision=r.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}V(y8,Xw,"PgTimestampString");function Fe(e,t={}){const{name:n,config:r}=Pn(e,t);return(r==null?void 0:r.mode)==="string"?new x8(n,r.withTimezone??!1,r.precision):new m8(n,(r==null?void 0:r.withTimezone)??!1,r==null?void 0:r.precision)}var Jw,eC;class b8 extends(eC=yt,Jw=ne,eC){constructor(t){super(t,"string","PgUUID")}defaultRandom(){return this.default(Uf`gen_random_uuid()`)}build(t){return new v8(t,this.config)}}V(b8,Jw,"PgUUIDBuilder");var tC,nC;class v8 extends(nC=nt,tC=ne,nC){getSQLType(){return"uuid"}}V(v8,tC,"PgUUID");function uJ(e){return new b8(e??"")}var rC,iC;class E8 extends(iC=yt,rC=ne,iC){constructor(t,n){super(t,"string","PgVarchar"),this.config.length=n.length,this.config.enumValues=n.enum}build(t){return new S8(t,this.config)}}V(E8,rC,"PgVarcharBuilder");var sC,oC;class S8 extends(oC=nt,sC=ne,oC){constructor(){super(...arguments);V(this,"length",this.config.length);V(this,"enumValues",this.config.enumValues)}getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}V(S8,sC,"PgVarchar");function he(e,t={}){const{name:n,config:r}=Pn(e,t);return new E8(n,r)}var aC,lC;class T8 extends(lC=yt,aC=ne,lC){constructor(t,n){super(t,"string","PgBinaryVector"),this.config.dimensions=n.dimensions}build(t){return new w8(t,this.config)}}V(T8,aC,"PgBinaryVectorBuilder");var cC,uC;class w8 extends(uC=nt,cC=ne,uC){constructor(){super(...arguments);V(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}V(w8,cC,"PgBinaryVector");function dJ(e,t){const{name:n,config:r}=Pn(e,t);return new T8(n,r)}var dC,pC;class C8 extends(pC=yt,dC=ne,pC){constructor(t,n){super(t,"array","PgHalfVector"),this.config.dimensions=n.dimensions}build(t){return new k8(t,this.config)}}V(C8,dC,"PgHalfVectorBuilder");var fC,hC;class k8 extends(hC=nt,fC=ne,hC){constructor(){super(...arguments);V(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(r=>Number.parseFloat(r))}}V(k8,fC,"PgHalfVector");function pJ(e,t){const{name:n,config:r}=Pn(e,t);return new C8(n,r)}var mC,gC;class A8 extends(gC=yt,mC=ne,gC){constructor(t,n){super(t,"string","PgSparseVector"),this.config.dimensions=n.dimensions}build(t){return new j8(t,this.config)}}V(A8,mC,"PgSparseVectorBuilder");var xC,yC;class j8 extends(yC=nt,xC=ne,yC){constructor(){super(...arguments);V(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}V(j8,xC,"PgSparseVector");function fJ(e,t){const{name:n,config:r}=Pn(e,t);return new A8(n,r)}var bC,vC;class I8 extends(vC=yt,bC=ne,vC){constructor(t,n){super(t,"array","PgVector"),this.config.dimensions=n.dimensions}build(t){return new _8(t,this.config)}}V(I8,bC,"PgVectorBuilder");var EC,SC;class _8 extends(SC=nt,EC=ne,SC){constructor(){super(...arguments);V(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(n){return JSON.stringify(n)}mapFromDriverValue(n){return n.slice(1,-1).split(",").map(r=>Number.parseFloat(r))}}V(_8,EC,"PgVector");function hJ(e,t){const{name:n,config:r}=Pn(e,t);return new I8(n,r)}function mJ(){return{bigint:VZ,bigserial:$Z,boolean:Dt,char:qZ,cidr:YZ,customType:KZ,date:GZ,doublePrecision:QZ,inet:XZ,integer:_e,interval:ZZ,json:JZ,jsonb:ui,line:eJ,macaddr:tJ,macaddr8:nJ,numeric:rJ,point:iJ,geometry:oJ,real:Vh,serial:Ft,smallint:aJ,smallserial:lJ,text:on,time:cJ,timestamp:Fe,uuid:uJ,varchar:he,bit:dJ,halfvec:pJ,sparsevec:fJ,vector:hJ}}const p0=Symbol.for("drizzle:PgInlineForeignKeys"),_E=Symbol.for("drizzle:EnableRLS");var TC,wC,CC,kC,AC;class hu extends(AC=cr,kC=ne,CC=p0,wC=_E,TC=cr.Symbol.ExtraConfigBuilder,AC){constructor(){super(...arguments);V(this,CC,[]);V(this,wC,!1);V(this,TC)}}V(hu,kC,"PgTable"),V(hu,"Symbol",Object.assign({},cr.Symbol,{InlineForeignKeys:p0,EnableRLS:_E}));function gJ(e,t,n,r,s=e){const o=new hu(e,r,s),a=typeof t=="function"?t(mJ()):t,l=Object.fromEntries(Object.entries(a).map(([d,p])=>{const f=p;f.setName(d);const h=f.build(o);return o[p0].push(...f.buildForeignKeys(h,o)),[d,h]})),c=Object.fromEntries(Object.entries(a).map(([d,p])=>{const f=p;f.setName(d);const h=f.buildExtraConfigColumn(o);return[d,h]})),u=Object.assign(o,l);return u[cr.Symbol.Columns]=l,u[cr.Symbol.ExtraConfigColumns]=c,n&&(u[hu.Symbol.ExtraConfigBuilder]=n),Object.assign(u,{enableRLS:()=>(u[hu.Symbol.EnableRLS]=!0,u)})}const Pt=(e,t,n)=>gJ(e,t,n,void 0);var jC;jC=ne;class N8{constructor(t,n){this.unique=t,this.name=n}on(...t){return new Lp(t.map(n=>{if(vn(n,pn))return n;n=n;const r=new Op(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),r}),this.unique,!1,this.name)}onOnly(...t){return new Lp(t.map(n=>{if(vn(n,pn))return n;n=n;const r=new Op(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=n.defaultConfig,r}),this.unique,!0,this.name)}using(t,...n){return new Lp(n.map(r=>{if(vn(r,pn))return r;r=r;const s=new Op(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),s}),this.unique,!0,this.name,t)}}V(N8,jC,"PgIndexBuilderOn");var IC;IC=ne;class Lp{constructor(t,n,r,s,o="btree"){V(this,"config");this.config={name:s,columns:t,unique:n,only:r,method:o}}concurrently(){return this.config.concurrently=!0,this}with(t){return this.config.with=t,this}where(t){return this.config.where=t,this}build(t){return new R8(this.config,t)}}V(Lp,IC,"PgIndexBuilder");var _C;_C=ne;class R8{constructor(t,n){V(this,"config");this.config={...t,table:n}}}V(R8,_C,"PgIndex");function Wt(e){return new N8(!1,e)}const en={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function fn(e,t){return t.includes(e.columnType)}function xJ(e){return"enumValues"in e&&Array.isArray(e.enumValues)&&e.enumValues.length>0}const yJ=ke.union([ke.string(),ke.number(),ke.boolean(),ke.null()]),bJ=ke.union([yJ,ke.record(ke.any()),ke.array(ke.any())]),vJ=ke.custom(e=>e instanceof Buffer);function D8(e,t){const n=(t==null?void 0:t.zodInstance)??ke,r=(t==null?void 0:t.coerce)??{};let s;return xJ(e)&&(s=e.enumValues.length?n.enum(e.enumValues):n.string()),s||(fn(e,["PgGeometry","PgPointTuple"])?s=n.tuple([n.number(),n.number()]):fn(e,["PgGeometryObject","PgPointObject"])?s=n.object({x:n.number(),y:n.number()}):fn(e,["PgHalfVector","PgVector"])?(s=n.array(n.number()),s=e.dimensions?s.length(e.dimensions):s):fn(e,["PgLine"])?s=n.tuple([n.number(),n.number(),n.number()]):fn(e,["PgLineABC"])?s=n.object({a:n.number(),b:n.number(),c:n.number()}):fn(e,["PgArray"])?(s=n.array(D8(e.baseColumn,n)),s=e.size?s.length(e.size):s):e.dataType==="array"?s=n.array(n.any()):e.dataType==="number"?s=EJ(e,n,r):e.dataType==="bigint"?s=SJ(e,n,r):e.dataType==="boolean"?s=r===!0||r.boolean?n.coerce.boolean():n.boolean():e.dataType==="date"?s=r===!0||r.date?n.coerce.date():n.date():e.dataType==="string"?s=TJ(e,n,r):e.dataType==="json"?s=bJ:e.dataType==="custom"?s=n.any():e.dataType==="buffer"&&(s=vJ)),s||(s=n.any()),s}function EJ(e,t,n){let r=e.getSQLType().includes("unsigned"),s,o,a=!1;fn(e,["MySqlTinyInt","SingleStoreTinyInt"])?(s=r?0:en.INT8_MIN,o=r?en.INT8_UNSIGNED_MAX:en.INT8_MAX,a=!0):fn(e,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(s=r?0:en.INT16_MIN,o=r?en.INT16_UNSIGNED_MAX:en.INT16_MAX,a=!0):fn(e,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(s=r?0:en.INT24_MIN,o=r?en.INT24_UNSIGNED_MAX:en.INT24_MAX,a=fn(e,["MySqlMediumInt","SingleStoreMediumInt"])):fn(e,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(s=r?0:en.INT32_MIN,o=r?en.INT32_UNSIGNED_MAX:en.INT32_MAX,a=!0):fn(e,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(s=r?0:en.INT48_MIN,o=r?en.INT48_UNSIGNED_MAX:en.INT48_MAX):fn(e,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(r=r||fn(e,["MySqlSerial","SingleStoreSerial"]),s=r?0:Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,a=!0):fn(e,["MySqlYear","SingleStoreYear"])?(s=1901,o=2155,a=!0):(s=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER);let l=n===!0||n!=null&&n.number?t.coerce.number():t.number();return l=l.min(s).max(o),a?l.int():l}function SJ(e,t,n){const r=e.getSQLType().includes("unsigned"),s=r?0n:en.INT64_MIN,o=r?en.INT64_UNSIGNED_MAX:en.INT64_MAX;return(n===!0||n!=null&&n.bigint?t.coerce.bigint():t.bigint()).min(s).max(o)}function TJ(e,t,n){if(fn(e,["PgUUID"]))return t.string().uuid();let r,s,o=!1;fn(e,["PgVarchar","SQLiteText"])?r=e.length:fn(e,["MySqlVarChar","SingleStoreVarChar"])?r=e.length??en.INT16_UNSIGNED_MAX:fn(e,["MySqlText","SingleStoreText"])&&(e.textType==="longtext"?r=en.INT32_UNSIGNED_MAX:e.textType==="mediumtext"?r=en.INT24_UNSIGNED_MAX:e.textType==="text"?r=en.INT16_UNSIGNED_MAX:r=en.INT8_UNSIGNED_MAX),fn(e,["PgChar","MySqlChar","SingleStoreChar"])&&(r=e.length,o=!0),fn(e,["PgBinaryVector"])&&(s=/^[01]+$/,r=e.dimensions);let a=n===!0||n!=null&&n.string?t.coerce.string():t.string();return a=s?a.regex(s):a,r&&o?a.length(r):r?a.max(r):a}function P8(e){return tR(e)?HZ(e):WZ(e)}function O8(e,t,n,r){const s={};for(const[o,a]of Object.entries(e)){if(!vn(a,rc)&&!vn(a,pn)&&!vn(a,pn.Aliased)&&typeof a=="object"){const p=tR(a)||UZ(a)?P8(a):a;s[o]=O8(p,t[o]??{},n,r);continue}const l=t[o];if(l!==void 0&&typeof l!="function"){s[o]=l;continue}const c=vn(a,rc)?a:void 0,u=c?D8(c,r):ke.any(),d=typeof l=="function"?l(u):u;n.never(c)||(s[o]=d,c&&(n.nullable(c)&&(s[o]=s[o].nullable()),n.optional(c)&&(s[o]=s[o].optional())))}return ke.object(s)}const wJ={never:e=>{var t,n;return((t=e==null?void 0:e.generated)==null?void 0:t.type)==="always"||((n=e==null?void 0:e.generatedIdentity)==null?void 0:n.type)==="always"},optional:e=>!e.notNull||e.notNull&&e.hasDefault,nullable:e=>!e.notNull},Bt=(e,t)=>{const n=P8(e);return O8(n,{},wJ)};Pt("sessions",{sid:he("sid").primaryKey(),sess:ui("sess").notNull(),expire:Fe("expire").notNull()},e=>[Wt("IDX_session_expire").on(e.expire)]);const CJ=Pt("email_verification_tokens",{id:Ft("id").primaryKey(),email:he("email").notNull(),token:he("token").notNull().unique(),expiresAt:Fe("expires_at").notNull(),isUsed:Dt("is_used").default(!1),createdAt:Fe("created_at").defaultNow()},e=>[Wt("idx_email_token").on(e.email),Wt("idx_token_expires").on(e.token,e.expiresAt)]),kJ=Pt("user_sessions",{id:Ft("id").primaryKey(),userId:he("user_id").notNull().references(()=>Ma.id),sessionToken:he("session_token").notNull().unique(),email:he("email").notNull(),companyId:_e("company_id").references(()=>In.id),roleLevel:_e("role_level").default(1),testRole:he("test_role"),expiresAt:Fe("expires_at").notNull(),lastAccessedAt:Fe("last_accessed_at").defaultNow(),createdAt:Fe("created_at").defaultNow()},e=>[Wt("idx_session_token").on(e.sessionToken),Wt("idx_user_session").on(e.userId)]),In=Pt("companies",{id:Ft("id").primaryKey(),name:he("name").notNull().unique(),domain:he("domain").unique(),primaryAdminName:he("primary_admin_name"),primaryAdminEmail:he("primary_admin_email"),primaryAdminTitle:he("primary_admin_title"),logo:on("logo"),logoSize:_e("logo_size").default(100),companyNameSize:_e("company_name_size").default(28),showCompanyName:Dt("show_company_name").default(!0),showCompanyLogo:Dt("show_company_logo").default(!0),isActive:Dt("is_active").default(!0),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()}),AJ=Pt("company_employees",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id),email:he("email").notNull(),role:he("role").default("employee"),department:he("department"),isActive:Dt("is_active").default(!0),addedAt:Fe("added_at").defaultNow()},e=>[Wt("idx_company_employee_email").on(e.email),Wt("idx_company_employee_company").on(e.companyId)]),L8=Pt("company_roles",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),name:he("name").notNull(),level:_e("level").notNull(),description:on("description"),permissions:ui("permissions"),isActive:Dt("is_active").default(!0),createdAt:Fe("created_at").defaultNow()},e=>[Wt("idx_company_role_level").on(e.companyId,e.level),$N("idx_company_role_unique_level").on(e.companyId,e.level)]),jJ=Pt("demo_users",{id:Ft("id").primaryKey(),email:he("email").notNull(),ipAddress:he("ip_address"),userAgent:on("user_agent"),questionsUsed:_e("questions_used").default(0),maxQuestions:_e("max_questions").default(3),sessionToken:he("session_token").unique().notNull(),expiresAt:Fe("expires_at").notNull(),createdAt:Fe("created_at").defaultNow(),lastQuestionAt:Fe("last_question_at")},e=>[Wt("idx_demo_session_token").on(e.sessionToken),Wt("idx_demo_email").on(e.email),Wt("idx_demo_ip").on(e.ipAddress)]),Ma=Pt("users",{id:he("id").primaryKey().notNull(),email:he("email").unique(),firstName:he("first_name"),lastName:he("last_name"),profileImageUrl:he("profile_image_url"),role:he("role").default("guest").notNull(),roleLevel:_e("role_level").default(0).notNull(),companyRoleId:_e("company_role_id").references(()=>L8.id),companyId:_e("company_id").references(()=>In.id),department:he("department"),isTrialUser:Dt("is_trial_user").default(!0),lastLoginAt:Fe("last_login_at"),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()}),IJ=Pt("subscriptions",{id:Ft("id").primaryKey(),type:he("type").notNull(),companyId:_e("company_id").references(()=>In.id),userId:he("user_id").references(()=>Ma.id),planId:he("plan_id").notNull(),status:he("status").notNull(),billingCycle:he("billing_cycle").default("monthly"),startDate:Fe("start_date").defaultNow(),endDate:Fe("end_date"),autoRenew:Dt("auto_renew").default(!0),maxUsers:_e("max_users"),pricePerMonth:Vh("price_per_month"),currency:he("currency").default("USD"),stripeSubscriptionId:he("stripe_subscription_id"),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()},e=>[Wt("idx_subscription_company").on(e.companyId),Wt("idx_subscription_user").on(e.userId),Wt("idx_subscription_status").on(e.status)]),_J=Pt("trial_usage",{id:Ft("id").primaryKey(),userId:he("user_id").references(()=>Ma.id).notNull(),companyId:_e("company_id").references(()=>In.id),email:he("email").notNull(),ipAddress:he("ip_address"),deviceFingerprint:he("device_fingerprint"),actionsUsed:_e("actions_used").default(0).notNull(),maxActions:_e("max_actions").default(10).notNull(),trialStartDate:Fe("trial_start_date").defaultNow(),trialEndDate:Fe("trial_end_date"),isTrialExpired:Dt("is_trial_expired").default(!1),hasUpgraded:Dt("has_upgraded").default(!1),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()},e=>[Wt("idx_trial_user").on(e.userId),Wt("idx_trial_email").on(e.email),Wt("idx_trial_ip").on(e.ipAddress),Wt("idx_trial_device").on(e.deviceFingerprint)]),NJ=Pt("ai_providers",{id:Ft("id").primaryKey(),name:he("name").notNull(),displayName:he("display_name").notNull(),description:on("description"),website:he("website"),apiDocUrl:he("api_doc_url"),isEnabled:Dt("is_enabled").default(!0).notNull(),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()}),M8=Pt("ai_model_templates",{id:Ft("id").primaryKey(),name:he("name").notNull(),provider:he("provider").notNull(),modelId:he("model_id").notNull(),description:on("description"),contextWindow:_e("context_window").default(4096).notNull(),isEnabled:Dt("is_enabled").default(!0).notNull(),capabilities:ui("capabilities"),apiEndpoint:on("api_endpoint").notNull(),authMethod:he("auth_method").default("bearer").notNull(),requestHeaders:ui("request_headers"),maxTokens:_e("max_tokens").default(1e3).notNull(),temperature:Vh("temperature").default(.7).notNull(),maxRetries:_e("max_retries").default(3).notNull(),timeout:_e("timeout").default(3e4).notNull(),rateLimit:_e("rate_limit").default(100).notNull(),createdAt:Fe("created_at").defaultNow()}),RJ=Pt("company_api_keys",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),templateId:_e("template_id").references(()=>M8.id).notNull(),apiKey:on("api_key").notNull(),organizationId:he("organization_id"),isEnabled:Dt("is_enabled").default(!0).notNull(),lastTested:Fe("last_tested"),isWorking:Dt("is_working"),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()},e=>[Wt("idx_company_api_key").on(e.companyId,e.templateId),$N("idx_company_template_unique").on(e.companyId,e.templateId)]),$h=Pt("ai_models",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),name:he("name").notNull(),provider:he("provider").notNull(),modelId:he("model_id").notNull(),description:on("description"),contextWindow:_e("context_window").default(4096).notNull(),isEnabled:Dt("is_enabled").default(!0).notNull(),capabilities:ui("capabilities"),apiKey:on("api_key").notNull(),apiEndpoint:on("api_endpoint").notNull(),authMethod:he("auth_method").default("bearer").notNull(),requestHeaders:ui("request_headers"),maxTokens:_e("max_tokens").default(1e3).notNull(),temperature:Vh("temperature").default(.7).notNull(),maxRetries:_e("max_retries").default(3).notNull(),timeout:_e("timeout").default(3e4).notNull(),rateLimit:_e("rate_limit").default(100).notNull(),organizationId:he("organization_id"),lastTested:Fe("last_tested"),isWorking:Dt("is_working"),createdAt:Fe("created_at").defaultNow()}),qh=Pt("activity_types",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),name:he("name").notNull(),description:on("description"),prePrompt:on("pre_prompt"),riskLevel:he("risk_level").default("low").notNull(),permissions:ui("permissions"),isEnabled:Dt("is_enabled").default(!0).notNull(),createdAt:Fe("created_at").defaultNow()}),DJ=Pt("permissions",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),name:he("name").notNull(),description:on("description"),category:he("category").notNull(),enabled:Dt("enabled").default(!0).notNull(),createdAt:Fe("created_at").defaultNow()},e=>[Wt("idx_permissions_company").on(e.companyId),Wt("idx_permissions_category").on(e.category)]),PJ=Pt("user_activities",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id),userId:he("user_id").references(()=>Ma.id).notNull(),aiModelId:_e("ai_model_id").references(()=>$h.id),activityTypeId:_e("activity_type_id").references(()=>qh.id),message:on("message"),response:on("response"),status:he("status").notNull(),securityFlags:ui("security_flags"),timestamp:Fe("timestamp").defaultNow().notNull(),description:on("description").notNull(),metadata:ui("metadata"),isTrialAction:Dt("is_trial_action").default(!1),tokenUsage:ui("token_usage")}),F8=Pt("chat_sessions",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),userId:he("user_id").references(()=>Ma.id).notNull(),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()}),B8=Pt("chat_messages",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),sessionId:_e("session_id").references(()=>F8.id).notNull(),userId:he("user_id").references(()=>Ma.id).notNull(),aiModelId:_e("ai_model_id").references(()=>$h.id).notNull(),activityTypeId:_e("activity_type_id").references(()=>qh.id).notNull(),message:on("message").notNull(),response:on("response"),status:he("status").notNull(),securityFlags:ui("security_flags"),timestamp:Fe("timestamp").defaultNow().notNull()}),OJ=Pt("chat_attachments",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),messageId:_e("message_id").references(()=>B8.id).notNull(),fileName:he("file_name").notNull(),originalName:he("original_name").notNull(),fileSize:_e("file_size").notNull(),mimeType:he("mime_type").notNull(),content:on("content").notNull(),uploadedAt:Fe("uploaded_at").defaultNow().notNull()},e=>[Wt("idx_chat_attachment_message").on(e.messageId),Wt("idx_chat_attachment_company").on(e.companyId)]),z8=Pt("context_documents",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),name:he("name").notNull(),description:on("description"),category:he("category").notNull(),fileName:he("file_name").notNull(),fileSize:_e("file_size").notNull(),content:on("content").notNull(),priority:_e("priority").default(1).notNull(),isEnabled:Dt("is_enabled").default(!0).notNull(),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()}),LJ=Pt("activity_context_links",{id:Ft("id").primaryKey(),activityTypeId:_e("activity_type_id").references(()=>qh.id).notNull(),documentId:_e("document_id").references(()=>z8.id).notNull(),usageType:he("usage_type").default("optional").notNull(),createdAt:Fe("created_at").defaultNow()},e=>[Wt("idx_activity_context_activity").on(e.activityTypeId),Wt("idx_activity_context_document").on(e.documentId)]),MJ=Pt("model_fusion_configs",{id:Ft("id").primaryKey(),companyId:_e("company_id").references(()=>In.id).notNull(),isEnabled:Dt("is_enabled").default(!1).notNull(),summaryModelId:_e("summary_model_id").references(()=>$h.id),createdAt:Fe("created_at").defaultNow(),updatedAt:Fe("updated_at").defaultNow()},e=>[Wt("idx_model_fusion_company").on(e.companyId)]);Bt(In).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(AJ).omit({id:!0,addedAt:!0});Bt(L8).omit({id:!0,createdAt:!0});Bt(Ma).omit({id:!0,createdAt:!0,updatedAt:!0});const FJ=Bt(NJ).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(M8).omit({id:!0,createdAt:!0});Bt(RJ).omit({id:!0,createdAt:!0,updatedAt:!0});Bt($h).omit({id:!0,createdAt:!0});Bt(qh).omit({id:!0,createdAt:!0});Bt(DJ).omit({id:!0,createdAt:!0});Bt(PJ).omit({id:!0,timestamp:!0});Bt(F8).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(B8).omit({id:!0,timestamp:!0});Bt(OJ).omit({id:!0,uploadedAt:!0});Bt(z8).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(LJ).omit({id:!0,createdAt:!0});Bt(MJ).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(CJ).omit({id:!0,createdAt:!0});Bt(kJ).omit({id:!0,createdAt:!0,lastAccessedAt:!0});const BJ=Pt("app_versions",{id:Ft("id").primaryKey(),majorVersion:_e("major_version").notNull(),minorVersion:_e("minor_version").notNull(),patchVersion:_e("patch_version").notNull(),version:he("version").notNull().unique(),title:he("title"),isCurrentVersion:Dt("is_current_version").default(!1),releaseDate:Fe("release_date").defaultNow(),createdAt:Fe("created_at").defaultNow()});Bt(BJ).omit({id:!0,createdAt:!0});const U8=Pt("subscription_plans",{id:Ft("id").primaryKey(),name:he("name",{length:100}).notNull(),displayName:he("display_name",{length:100}).notNull(),price:he("price",{length:20}).notNull(),billingPeriod:he("billing_period",{length:20}).notNull(),maxUsers:_e("max_users"),dailyApiLimit:_e("daily_api_limit").notNull(),monthlyApiLimit:_e("monthly_api_limit").notNull(),requiresCreditCard:Dt("requires_credit_card").notNull().default(!1),requiresApiKey:Dt("requires_api_key").notNull().default(!1),features:on("features").array(),isActive:Dt("is_active").notNull().default(!0),createdAt:Fe("created_at").notNull().defaultNow()}),H8=Pt("user_subscriptions",{id:Ft("id").primaryKey(),userId:he("user_id",{length:255}).notNull(),companyId:_e("company_id").references(()=>In.id),planId:_e("plan_id").references(()=>U8.id).notNull(),status:he("status",{length:20}).notNull(),stripeCustomerId:he("stripe_customer_id",{length:255}),stripeSubscriptionId:he("stripe_subscription_id",{length:255}),currentPeriodStart:Fe("current_period_start"),currentPeriodEnd:Fe("current_period_end"),trialEnd:Fe("trial_end"),cancelAt:Fe("cancel_at"),canceledAt:Fe("canceled_at"),createdAt:Fe("created_at").notNull().defaultNow(),updatedAt:Fe("updated_at").notNull().defaultNow()}),zJ=Pt("api_usage_tracking",{id:Ft("id").primaryKey(),userId:he("user_id",{length:255}).notNull(),companyId:_e("company_id").references(()=>In.id),subscriptionId:_e("subscription_id").references(()=>H8.id),date:he("date",{length:10}).notNull(),apiCalls:_e("api_calls").notNull().default(0),aiTokensUsed:_e("ai_tokens_used").notNull().default(0),ipAddress:he("ip_address",{length:45}),userAgent:he("user_agent",{length:500}),createdAt:Fe("created_at").notNull().defaultNow(),updatedAt:Fe("updated_at").notNull().defaultNow()}),UJ=Pt("payment_methods",{id:Ft("id").primaryKey(),userId:he("user_id",{length:255}).notNull(),stripePaymentMethodId:he("stripe_payment_method_id",{length:255}).notNull(),type:he("type",{length:20}).notNull(),cardBrand:he("card_brand",{length:20}),cardLast4:he("card_last4",{length:4}),cardExpMonth:_e("card_exp_month"),cardExpYear:_e("card_exp_year"),isDefault:Dt("is_default").notNull().default(!1),isValid:Dt("is_valid").notNull().default(!0),createdAt:Fe("created_at").notNull().defaultNow(),updatedAt:Fe("updated_at").notNull().defaultNow()});Bt(U8).omit({id:!0,createdAt:!0});Bt(H8).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(zJ).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(UJ).omit({id:!0,createdAt:!0,updatedAt:!0});Bt(IJ);Bt(_J);Bt(jJ).omit({id:!0,createdAt:!0});function HJ({size:e=20,message:t="Loading...",showMessage:n=!0}){return i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",padding:"20px"},children:[i.jsx("div",{style:{width:`${e}px`,height:`${e}px`,animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"AI Sentinel Loading...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})}),n&&i.jsx("span",{style:{color:"#6b7280",fontSize:"16px",fontWeight:"500"},children:t})]})}function WJ(){const[e,t]=E.useState(!1),[n,r]=E.useState(!1),[s,o]=E.useState(null),[a,l]=E.useState(!1),[c,u]=E.useState(null),[d,p]=E.useState({checking:!1,exists:!1,message:""}),{toast:f}=Mt();Xn();const{user:h}=Nt();if(!h||(h.roleLevel??0)<1e3)return i.jsx(qe,{title:"AI Providers",subtitle:"Manage universal AI providers for the platform",children:i.jsxs("div",{style:{padding:"24px",textAlign:"center",backgroundColor:"#f8fafc",minHeight:"100vh"},children:[i.jsxs("div",{style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",padding:"40px 0",marginBottom:"32px",textAlign:"center",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",borderRadius:"12px"},children:[i.jsx("h1",{style:{fontSize:"32px",fontWeight:"bold",margin:0},children:"AI Providers"}),i.jsx("p",{style:{margin:"8px 0 0 0",opacity:.9},children:"Manage universal AI providers for the platform"})]}),i.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"20px",maxWidth:"400px",margin:"0 auto"},children:[i.jsx("h2",{style:{color:"#ef4444",fontSize:"24px",marginBottom:"16px"},children:"Access Denied"}),i.jsx("p",{style:{color:"#6b7280"},children:"Super-user access (1000+) required for AI Provider management."}),i.jsxs("p",{style:{color:"#6b7280",fontSize:"14px",marginTop:"8px"},children:["Current access level: ",(h==null?void 0:h.roleLevel)??0]})]})]})});const y=ls({resolver:cs(FJ),defaultValues:{name:"",displayName:"",description:"",website:"",apiDocUrl:"",isEnabled:!0}}),g=localStorage.getItem("sessionToken")||"prod-1754052835575-289kvxqgl42h",{data:S=[],isLoading:b,error:x,refetch:v}=ct({queryKey:["/api/admin/ai-providers"],staleTime:0,gcTime:0,queryFn:async()=>{console.log("ðŸ” [AI-PROVIDERS] Fetching providers from Railway database...");try{const C=await fetch("/api/admin/ai-providers",{method:"GET",headers:{Authorization:`Bearer ${g}`,"X-Session-Token":g,"Content-Type":"application/json"},credentials:"include"});if(!C.ok){const k=await C.text();throw console.error("âŒ [AI-PROVIDERS] Fetch failed:",C.status,C.statusText,k),new Error(`Failed to fetch providers: ${C.status} - ${k}`)}const _=await C.json();return console.log("âœ… [AI-PROVIDERS] Fetched providers from database:",_.length,"providers"),_.length>0&&(console.log("ðŸ” [PRODUCTION-DEBUG] First provider data structure:",{id:_[0].id,name:_[0].name,displayName:_[0].displayName,isEnabled:_[0].isEnabled,isEnabledType:typeof _[0].isEnabled,booleanCheck:!!_[0].isEnabled}),console.log("ðŸ” [PRODUCTION-DEBUG] All provider names and status:"),_.forEach((k,B)=>{console.log(`  ${B+1}. ${k.displayName} (${k.name}) - isEnabled: ${k.isEnabled} (${typeof k.isEnabled})`)})),_}catch(C){throw console.error("âŒ [AI-PROVIDERS] Network or parsing error:",C),C}}}),T=Le.useCallback(Le.useMemo(()=>{let C;return _=>{if(clearTimeout(C),!_||_.length<2){p({checking:!1,exists:!1,message:""});return}p({checking:!0,exists:!1,message:"Checking name..."}),C=setTimeout(async()=>{const k=S.some(B=>{var j;return((j=B.name)==null?void 0:j.toLowerCase())===_.toLowerCase()&&(!s||B.id!==s.id)});p(k?{checking:!1,exists:!0,message:"âŒ This provider name is already taken"}:{checking:!1,exists:!1,message:"âœ… Provider name is available"})},300)}},[S,s]),[S,s]),R=st({mutationFn:async C=>{console.log("ðŸ”„ [AI-PROVIDERS] Creating provider:",C.name);const _=await fetch("/api/admin/ai-providers",{method:"POST",headers:{Authorization:`Bearer ${g}`,"X-Session-Token":g,"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(C)});if(!_.ok){const B=await _.text();throw console.error("âŒ [AI-PROVIDERS] Create failed:",_.status,B),new Error(B||`Failed to create provider: ${_.status}`)}const k=await _.json();return console.log("âœ… [AI-PROVIDERS] Provider created successfully:",k.id),k},onSuccess:()=>{v(),f({title:"Provider Created",description:"AI provider has been created successfully."}),t(!1),p({checking:!1,exists:!1,message:""}),y.reset()},onError:C=>{console.error("âŒ [AI-PROVIDERS] Create mutation error:",C);let _="Failed to create provider";(C!=null&&C.message.includes("duplicate key")||C!=null&&C.message.includes("unique constraint")||C!=null&&C.message.includes("violates unique constraint"))&&(_="This provider name already exists. Please choose a different name."),f({title:"Error",description:_,variant:"destructive"})}}),w=st({mutationFn:async({id:C,data:_})=>{console.log("ðŸ”„ [AI-PROVIDERS] Updating provider:",C,_.name);const k=await fetch(`/api/admin/ai-providers/${C}`,{method:"PUT",headers:{Authorization:`Bearer ${g}`,"X-Session-Token":g,"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(_)});if(!k.ok){const j=await k.text();throw console.error("âŒ [AI-PROVIDERS] Update failed:",k.status,j),new Error(j||`Failed to update provider: ${k.status}`)}const B=await k.json();return console.log("âœ… [AI-PROVIDERS] Provider updated successfully:",C),B},onSuccess:()=>{v(),f({title:"Provider Updated",description:"AI provider has been updated successfully."}),r(!1),o(null),p({checking:!1,exists:!1,message:""}),y.reset()},onError:C=>{console.error("âŒ [AI-PROVIDERS] Update mutation error:",C),f({title:"Error",description:C.message||"Failed to update provider",variant:"destructive"})}}),L=st({mutationFn:async C=>{if(console.log("ðŸ”„ [AI-PROVIDERS DELETE] Starting deletion for provider:",C),console.log("ðŸ”„ [AI-PROVIDERS DELETE] Token available:",!!g,"Token preview:",(g==null?void 0:g.substring(0,20))+"..."),!g)throw console.error("âŒ [AI-PROVIDERS DELETE] No authentication token available"),new Error("Authentication token not available");const _=`/api/admin/ai-providers/${C}`;console.log("ðŸ”„ [AI-PROVIDERS DELETE] Making DELETE request to:",_);const k=await fetch(_,{method:"DELETE",headers:{Authorization:`Bearer ${g}`,"X-Session-Token":g,"Content-Type":"application/json"},credentials:"include"});if(console.log("ðŸ”„ [AI-PROVIDERS DELETE] Response status:",k.status),console.log("ðŸ”„ [AI-PROVIDERS DELETE] Response ok:",k.ok),console.log("ðŸ”„ [AI-PROVIDERS DELETE] Response headers:",Object.fromEntries(k.headers.entries())),!k.ok){const j=await k.text();throw console.error("âŒ [AI-PROVIDERS DELETE] Delete failed:",{status:k.status,statusText:k.statusText,errorText:j,url:_}),new Error(j||`Failed to delete provider: ${k.status} ${k.statusText}`)}const B=await k.json();return console.log("âœ… [AI-PROVIDERS DELETE] Provider deleted successfully:",{id:C,result:B}),B},onSuccess:()=>{v(),f({title:"Provider Deleted",description:"AI provider has been deleted successfully."}),l(!1),u(null)},onError:C=>{console.error("âŒ [AI-PROVIDERS] Delete mutation error:",C),f({title:"Error",description:C.message||"Failed to delete provider",variant:"destructive"})}}),U=C=>{if(console.log("ðŸš€ [FORM SUBMIT] Form submission triggered:",C),console.log("ðŸ” [FORM SUBMIT] Name check result:",d),console.log("ðŸ” [FORM SUBMIT] Editing provider:",s),d.exists){console.log("âŒ [FORM SUBMIT] Blocked - duplicate name detected"),f({variant:"destructive",title:"Duplicate Name",description:"This name already exists. Please choose a different name."});return}console.log("âœ… [FORM SUBMIT] Proceeding with submission..."),s?(console.log("ðŸ”§ [FORM SUBMIT] Update mode - calling updateProviderMutation"),w.mutate({id:s.id,data:C})):(console.log("âž• [FORM SUBMIT] Create mode - calling createProviderMutation"),R.mutate(C))},Y=C=>{console.log("ðŸ”§ [AI-PROVIDERS] Editing provider:",C.id,C.name),console.log("ðŸ”§ [AI-PROVIDERS] Provider data:",{name:C.name,displayName:C.displayName,description:C.description,website:C.website,apiDocUrl:C.apiDocUrl,isEnabled:C.isEnabled}),o(C),p({checking:!1,exists:!1,message:""});const _={name:C.name||"",displayName:C.displayName||"",description:C.description||"",website:C.website||"",apiDocUrl:C.apiDocUrl||"",isEnabled:!!C.isEnabled};console.log("ðŸ”§ [AI-PROVIDERS] Form data being set:",_),y.reset(_),setTimeout(()=>{y.setValue("name",C.name||""),y.setValue("displayName",C.displayName||""),y.setValue("description",C.description||""),y.setValue("website",C.website||""),y.setValue("apiDocUrl",C.apiDocUrl||""),y.setValue("isEnabled",!!C.isEnabled),console.log("ðŸ”§ [AI-PROVIDERS] All fields explicitly set:",{name:C.name,displayName:C.displayName,isEnabled:C.isEnabled})},100),console.log("ðŸ”§ [AI-PROVIDERS] Form reset with values, opening edit dialog..."),r(!0)},D=C=>{console.log("ðŸ—‘ï¸ [AI-PROVIDERS] Preparing to delete provider:",C.id,C.name),u(C),l(!0)},O=()=>{console.log("ðŸ—‘ï¸ [AI-PROVIDERS DELETE] Confirm delete called"),console.log("ðŸ—‘ï¸ [AI-PROVIDERS DELETE] Provider to delete:",c),console.log("ðŸ—‘ï¸ [AI-PROVIDERS DELETE] Token available:",!!g),console.log("ðŸ—‘ï¸ [AI-PROVIDERS DELETE] Delete mutation pending:",L.isPending),c?(console.log("ðŸ—‘ï¸ [AI-PROVIDERS DELETE] Triggering mutation for provider ID:",c.id),L.mutate(c.id)):console.error("âŒ [AI-PROVIDERS DELETE] No provider selected for deletion")};return b?i.jsx(qe,{title:"AI Providers",subtitle:"Manage universal AI providers for the platform",children:i.jsx(HJ,{size:24,message:"Loading AI providers from database..."})}):x?i.jsx(qe,{title:"AI Providers",subtitle:"Manage universal AI providers for the platform",children:i.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"20px",textAlign:"center"},children:[i.jsx("h2",{style:{color:"#ef4444",fontSize:"20px",marginBottom:"12px"},children:"Error Loading Providers"}),i.jsx("p",{style:{color:"#6b7280",marginBottom:"16px"},children:(x==null?void 0:x.message)||"Failed to fetch AI providers from the database"}),i.jsx(me,{onClick:()=>v(),style:{backgroundColor:"#3b82f6",color:"white",border:"1px solid #3b82f6",borderRadius:"8px",padding:"8px 16px"},children:"Try Again"})]})}):i.jsx(qe,{title:"AI Providers",subtitle:"Manage universal AI providers for the platform",rightContent:i.jsxs(me,{onClick:()=>t(!0),style:{backgroundColor:"#3b82f6",color:"white",border:"1px solid #3b82f6",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Tn,{size:20}),"Add Provider"]}),children:i.jsxs("div",{style:{backgroundColor:"#f8fafc",minHeight:"100vh",padding:"32px"},children:[i.jsxs("h2",{style:{fontSize:"24px",fontWeight:"600",color:"#3b82f6",margin:"0 0 24px 0"},children:["Provider Management (",S.length," providers)"]}),i.jsx(rn,{open:e,onOpenChange:t,children:i.jsxs(Qt,{style:{maxWidth:"600px"},children:[i.jsxs(Xt,{children:[i.jsx(Zt,{children:"Add New AI Provider"}),i.jsx(ci,{children:"Create a new AI provider that will be available throughout the platform."})]}),i.jsx(os,{...y,children:i.jsxs("form",{onSubmit:y.handleSubmit(U),style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Ne,{control:y.control,name:"name",render:({field:C})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Internal Name (must be unique)"]}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"openai",...C,onChange:_=>{C.onChange(_),T(_.target.value)},style:{borderColor:d.exists?"#ef4444":d.message.includes("âœ…")?"#10b981":"#d1d5db",backgroundColor:d.exists?"#fef2f2":d.message.includes("âœ…")?"#f0fdf4":"#ffffff"}})}),d.message&&i.jsxs("div",{style:{fontSize:"13px",marginTop:"4px",fontWeight:"500",color:d.checking?"#6b7280":d.exists?"#ef4444":"#10b981",display:"flex",alignItems:"center",gap:"4px",backgroundColor:d.exists?"#fef2f2":d.message.includes("âœ…")?"#f0fdf4":"transparent",padding:d.message?"6px 8px":"0",borderRadius:"4px",border:d.exists?"1px solid #fecaca":d.message.includes("âœ…")?"1px solid #bbf7d0":"none"},children:[d.checking&&i.jsx("div",{style:{width:"12px",height:"12px",animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Checking...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})}),d.message]}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:y.control,name:"displayName",render:({field:C})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Display Name"]}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"OpenAI",...C})}),i.jsx(Pe,{})]})})]}),i.jsx(Ne,{control:y.control,name:"description",render:({field:C})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:"Description"}),i.jsx(Re,{children:i.jsx(Ni,{placeholder:"Brief description of the AI provider...",...C,value:C.value||"",style:{minHeight:"80px"}})}),i.jsx(Pe,{})]})}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Ne,{control:y.control,name:"website",render:({field:C})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:"Website URL"}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"https://openai.com",...C,value:C.value||""})}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:y.control,name:"apiDocUrl",render:({field:C})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:"API Documentation URL"}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"https://platform.openai.com/docs",...C,value:C.value||""})}),i.jsx(Pe,{})]})})]}),i.jsx(Ne,{control:y.control,name:"isEnabled",render:({field:C})=>i.jsxs(je,{style:{marginTop:"16px"},children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px",display:"block"},children:"Provider Status"}),i.jsx(Re,{children:i.jsxs("button",{type:"button",onClick:()=>C.onChange(!C.value),style:{width:"100%",padding:"12px 16px",border:"2px solid",borderColor:C.value?"#10b981":"#ef4444",borderRadius:"8px",backgroundColor:C.value?"#10b981":"#ef4444",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease",outline:"none"},onMouseOver:_=>{_.target.style.opacity="0.9",_.target.style.transform="translateY(-1px)"},onMouseOut:_=>{_.target.style.opacity="1",_.target.style.transform="translateY(0)"},children:[i.jsx("span",{style:{fontSize:"16px"},children:C.value?"âœ…":"âŒ"}),C.value?"PROVIDER ENABLED":"PROVIDER DISABLED",i.jsx("span",{style:{marginLeft:"auto",fontSize:"12px",backgroundColor:"rgba(255,255,255,0.2)",padding:"2px 6px",borderRadius:"4px"},children:C.value?"ACTIVE":"INACTIVE"})]})})]})}),i.jsx(me,{type:"submit",disabled:R.isPending||w.isPending||d.exists||d.checking,onClick:()=>{console.log("ðŸ–±ï¸ [BUTTON CLICK] Create Provider button clicked"),console.log("ðŸ” [BUTTON CLICK] Button disabled?",R.isPending||w.isPending||d.exists||d.checking),console.log("ðŸ” [BUTTON CLICK] Name check result:",d)},style:{width:"100%",backgroundColor:d.exists||d.checking?"#9ca3af":"#10b981",color:"white",border:d.exists||d.checking?"1px solid #9ca3af":"1px solid #10b981",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:d.exists||d.checking?"not-allowed":"pointer",opacity:R.isPending||w.isPending||d.checking?.7:1,marginTop:"8px"},children:d.checking?"Checking...":d.exists?"Name unavailable":R.isPending?"Creating...":"Create Provider"})]})})]})}),S.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"60px 32px",backgroundColor:"#ffffff",borderRadius:"12px",margin:"0 32px",border:"1px solid #e5e7eb"},children:[i.jsx("h3",{style:{fontSize:"20px",color:"#6b7280",marginBottom:"12px"},children:"No AI Providers Found"}),i.jsx("p",{style:{color:"#9ca3af",marginBottom:"24px"},children:"Get started by adding your first AI provider to the platform."}),i.jsxs(me,{onClick:()=>t(!0),style:{backgroundColor:"#3b82f6",color:"white",border:"1px solid #3b82f6",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},children:[i.jsx(Tn,{style:{width:"16px",height:"16px",marginRight:"8px"}}),"Add First Provider"]})]}):i.jsx("div",{style:{display:"grid",gap:"16px",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))"},children:S.map(C=>(console.log("ðŸŽ¨ [RENDER-DEBUG] Rendering provider:",{id:C.id,name:C.name,displayName:C.displayName,isEnabled:C.isEnabled,isEnabledType:typeof C.isEnabled,booleanCheck:!!C.isEnabled,strictCheck:C.isEnabled===!0}),i.jsxs(Sn,{style:{border:"1px solid #e5e7eb",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[i.jsx("div",{style:{padding:"16px",borderBottom:"1px solid #e5e7eb"},children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"8px",backgroundColor:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Lu,{style:{width:"20px",height:"20px",color:"#6b7280"}})}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontWeight:"700",fontSize:"18px",marginBottom:"4px",color:"#1f2937"},children:C.displayName}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:C.name})]})]}),i.jsx("span",{style:{backgroundColor:C.isEnabled===!0?"#10b981":"#6b7280",color:"white",fontWeight:"600",padding:"6px 12px",borderRadius:"6px",fontSize:"12px"},children:C.isEnabled===!0?"ACTIVE":"INACTIVE"})]})}),i.jsxs(Fn,{style:{padding:"16px"},children:[C.description&&i.jsx("div",{style:{marginBottom:"16px"},children:i.jsx("p",{style:{fontSize:"14px",color:"#4b5563",lineHeight:"1.5"},children:C.description})}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"16px"},children:[C.website&&i.jsxs("a",{href:C.website,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"13px",color:"#3b82f6",textDecoration:"none"},children:[i.jsx(Lu,{style:{width:"12px",height:"12px"}}),"Website"]}),C.apiDocUrl&&i.jsxs("a",{href:C.apiDocUrl,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:"4px",fontSize:"13px",color:"#3b82f6",textDecoration:"none"},children:[i.jsx(NL,{style:{width:"12px",height:"12px"}}),"API Docs"]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsxs(me,{onClick:()=>Y(C),style:{backgroundColor:"#f97316",color:"white",border:"1px solid #f97316",borderRadius:"6px",padding:"2px 4px",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",flex:1},children:[i.jsx(yy,{style:{width:"16px",height:"16px"}}),"Edit"]}),i.jsxs(me,{onClick:()=>D(C),style:{backgroundColor:"#ef4444",color:"white",border:"1px solid #ef4444",borderRadius:"6px",padding:"2px 4px",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",flex:1},children:[i.jsx(Gn,{style:{width:"16px",height:"16px"}}),"Delete"]})]})]})]},C.id)))}),i.jsx(rn,{open:n,onOpenChange:r,children:i.jsxs(Qt,{style:{maxWidth:"600px"},children:[i.jsxs(Xt,{children:[i.jsx(Zt,{children:"Edit AI Provider"}),i.jsx(ci,{children:"Update the AI provider information."})]}),i.jsx(os,{...y,children:i.jsxs("form",{onSubmit:y.handleSubmit(U),style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Ne,{control:y.control,name:"name",render:({field:C})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Internal Name (must be unique)"]}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"openai",...C,onChange:_=>{C.onChange(_),T(_.target.value)},style:{borderColor:d.exists?"#ef4444":d.message.includes("âœ…")?"#10b981":"#d1d5db",backgroundColor:d.exists?"#fef2f2":d.message.includes("âœ…")?"#f0fdf4":"#ffffff"}})}),d.message&&i.jsxs("div",{style:{fontSize:"13px",marginTop:"4px",fontWeight:"500",color:d.checking?"#6b7280":d.exists?"#ef4444":"#10b981",display:"flex",alignItems:"center",gap:"4px",backgroundColor:d.exists?"#fef2f2":d.message.includes("âœ…")?"#f0fdf4":"transparent",padding:d.message?"6px 8px":"0",borderRadius:"4px",border:d.exists?"1px solid #fecaca":d.message.includes("âœ…")?"1px solid #bbf7d0":"none"},children:[d.checking&&i.jsx("div",{style:{width:"12px",height:"12px",animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Checking...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})}),d.message]}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:y.control,name:"displayName",render:({field:C})=>i.jsxs(je,{children:[i.jsxs(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:[i.jsx("span",{style:{color:"#dc2626"},children:"*"})," Display Name"]}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"OpenAI",...C,value:C.value||""})}),i.jsx(Pe,{})]})})]}),i.jsx(Ne,{control:y.control,name:"description",render:({field:C})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:"Description"}),i.jsx(Re,{children:i.jsx(Ni,{placeholder:"Brief description of the AI provider...",...C,value:C.value||"",style:{minHeight:"80px"}})}),i.jsx(Pe,{})]})}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsx(Ne,{control:y.control,name:"website",render:({field:C})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:"Website URL"}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"https://openai.com",...C,value:C.value||""})}),i.jsx(Pe,{})]})}),i.jsx(Ne,{control:y.control,name:"apiDocUrl",render:({field:C})=>i.jsxs(je,{children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500"},children:"API Documentation URL"}),i.jsx(Re,{children:i.jsx(Oe,{placeholder:"https://platform.openai.com/docs",...C,value:C.value||""})}),i.jsx(Pe,{})]})})]}),i.jsx(Ne,{control:y.control,name:"isEnabled",render:({field:C})=>i.jsxs(je,{style:{marginTop:"16px"},children:[i.jsx(Ie,{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px",display:"block"},children:"Provider Status"}),i.jsx(Re,{children:i.jsxs("button",{type:"button",onClick:()=>C.onChange(!C.value),style:{width:"100%",padding:"12px 16px",border:"2px solid",borderColor:C.value?"#10b981":"#ef4444",borderRadius:"8px",backgroundColor:C.value?"#10b981":"#ef4444",color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease",outline:"none"},onMouseOver:_=>{_.target.style.opacity="0.9",_.target.style.transform="translateY(-1px)"},onMouseOut:_=>{_.target.style.opacity="1",_.target.style.transform="translateY(0)"},children:[i.jsx("span",{style:{fontSize:"16px"},children:C.value?"âœ…":"âŒ"}),C.value?"PROVIDER ENABLED":"PROVIDER DISABLED",i.jsx("span",{style:{marginLeft:"auto",fontSize:"12px",backgroundColor:"rgba(255,255,255,0.2)",padding:"2px 6px",borderRadius:"4px"},children:C.value?"ACTIVE":"INACTIVE"})]})})]})}),i.jsx(me,{type:"submit",disabled:R.isPending||w.isPending||d.exists||d.checking,onClick:()=>{console.log("ðŸ–±ï¸ [BUTTON CLICK] Update Provider button clicked"),console.log("ðŸ” [BUTTON CLICK] Button disabled?",R.isPending||w.isPending||d.exists||d.checking),console.log("ðŸ” [BUTTON CLICK] Name check result:",d),console.log("ðŸ” [BUTTON CLICK] Editing provider:",s)},style:{width:"100%",backgroundColor:d.exists||d.checking?"#9ca3af":"#10b981",color:"white",border:d.exists||d.checking?"1px solid #9ca3af":"1px solid #10b981",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:d.exists||d.checking?"not-allowed":"pointer",opacity:R.isPending||w.isPending||d.checking?.7:1,marginTop:"8px"},children:d.checking?"Checking...":d.exists?"Name unavailable":w.isPending?"Updating...":"Update Provider"})]})})]})}),i.jsx(rn,{open:a,onOpenChange:l,children:i.jsxs(Qt,{style:{maxWidth:"500px"},children:[i.jsxs(Xt,{children:[i.jsx(Zt,{style:{color:"#ef4444"},children:"Delete AI Provider"}),i.jsx(ci,{children:"This action cannot be undone. This will permanently delete the AI provider and remove it from all configurations."})]}),c&&i.jsxs("div",{style:{backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"16px",margin:"16px 0"},children:[i.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#ef4444",margin:"0 0 8px 0"},children:c.displayName}),i.jsxs("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 4px 0"},children:["Internal name: ",c.name]}),i.jsxs("p",{style:{fontSize:"14px",color:"#6b7280",margin:0},children:["Status: ",c.isEnabled?"Enabled":"Disabled"]})]}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[i.jsx(me,{variant:"outline",onClick:()=>l(!1),style:{backgroundColor:"#ffffff",border:"1px solid #d1d5db",borderRadius:"8px",padding:"8px 16px",cursor:"pointer"},children:"Cancel"}),i.jsx(me,{onClick:O,disabled:L.isPending,style:{backgroundColor:"#ef4444",color:"white",border:"1px solid #ef4444",borderRadius:"8px",padding:"8px 16px",cursor:"pointer",opacity:L.isPending?.7:1},children:L.isPending?i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("div",{style:{width:"14px",height:"14px",animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Deleting...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(2) saturate(0) contrast(1)"}})}),"Deleting..."]}):"Delete Provider"})]})]})}),i.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]})})}function VJ(){var R;const{user:e}=Nt(),t=Xn(),n=er(e),{showDialog:r,closeDialog:s,DialogComponent:o}=Kr(),a=w=>{const L={title:"Model Fusion",description:"Configure advanced multi-model AI processing for comprehensive research and analysis. Combine multiple AI models to provide thorough, well-rounded responses.",features:["Enable/disable multi-model processing for enhanced accuracy","Select summary model to consolidate responses from all models","Configure which AI models participate in fusion processing","Real-time processing across OpenAI, Anthropic, and other providers","Comprehensive analysis combining different AI perspectives","Advanced response synthesis and conflict resolution"]};s(),setTimeout(()=>{r(L)},10)};if(!jd(e==null?void 0:e.roleLevel,99))return i.jsx(qe,{title:"Model Fusion",subtitle:"Set up advanced multi-model AI processing for comprehensive research and analysis",children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"400px",textAlign:"center",padding:"40px"},children:[i.jsx(ba,{style:{width:"64px",height:"64px",color:"#ef4444",marginBottom:"24px"}}),i.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#1f2937",marginBottom:"12px"},children:"Access Denied"}),i.jsx("p",{style:{fontSize:"16px",color:"#6b7280",marginBottom:"8px"},children:"Owner level access required (99+)"}),i.jsx("p",{style:{fontSize:"14px",color:"#9ca3af"},children:"Contact your system administrator for access"})]})});const[l,c]=E.useState({isEnabled:!1,summaryModelId:null}),[u,d]=E.useState(new Set),{data:p=[],isLoading:f}=ct({queryKey:["/api/ai-models"]}),{data:h,isLoading:y}=ct({queryKey:["/api/model-fusion-config"]});E.useEffect(()=>{h&&c(h)},[h]),E.useEffect(()=>{if(p.length>0){const w=p.filter(L=>L.isEnabled).map(L=>L.id);d(new Set(w))}},[p]);const g=st({mutationFn:async w=>{const L=h!=null&&h.id?"PUT":"POST",U=h!=null&&h.id?`/api/model-fusion-config/${h.id}`:"/api/model-fusion-config";return await vt(U,L,w)},onSuccess:()=>{Cp({title:"Configuration Saved",description:"Model Fusion settings have been updated successfully."}),t.invalidateQueries({queryKey:["/api/model-fusion-config"]})},onError:w=>{Cp({title:"Error",description:w.message||"Failed to save configuration",variant:"destructive"})}}),S=w=>{c(L=>({...L,isEnabled:w}))},b=w=>{c(L=>({...L,summaryModelId:parseInt(w)}))},x=(w,L)=>{d(U=>{const Y=new Set(U);return L?Y.add(w):Y.delete(w),Y})},v=()=>{if(l.isEnabled&&!l.summaryModelId){Cp({title:"Validation Error",description:"Please select a summary model when Deep Research is enabled.",variant:"destructive"});return}g.mutate(l)},T=p.filter(w=>w.isEnabled);return f||y?i.jsx(qe,{title:"Model Fusion",subtitle:"Set up advanced multi-model AI processing for comprehensive research and analysis",children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"400px",gap:"20px"},children:[i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"AI Sentinel",style:{width:"64px",height:"64px",animation:"spin 2s linear infinite",filter:"brightness(1.1) saturate(1.3) contrast(1.2)"}}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1f2937",marginBottom:"8px"},children:"Loading Model Fusion Configuration"}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280"},children:"Fetching your multi-model AI processing settings..."})]})]})}):i.jsxs(qe,{title:"Model Fusion",subtitle:"Set up advanced multi-model AI processing for comprehensive research and analysis",rightContent:i.jsx(Ui,{message:"Demo Mode - Read Only View - Model fusion settings cannot be modified"}),children:[i.jsx("div",{style:{padding:"24px"},children:i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"24px"},children:[i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:i.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"1px solid #e5e7eb",overflow:"hidden"},children:i.jsxs("div",{style:{padding:"24px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px",backgroundColor:"#f8fafc",borderRadius:"8px",marginBottom:"24px"},children:[i.jsxs("div",{style:{flex:1},children:[i.jsx("label",{htmlFor:"model-fusion-enabled",style:{display:"block",fontSize:"16px",fontWeight:"500",color:"#1f2937",marginBottom:"4px"},children:"Enable Model Fusion"}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:0},children:"When enabled, users can submit prompts to multiple AI models simultaneously"})]}),i.jsx(Oo,{id:"model-fusion-enabled",checked:l.isEnabled||!1,onCheckedChange:n?()=>a():S,disabled:n,style:{opacity:n?.6:1,cursor:n?"not-allowed":"pointer"}})]}),i.jsx("div",{style:{height:"1px",backgroundColor:"#e5e7eb",margin:"24px 0"}}),i.jsxs("div",{style:{marginBottom:"24px"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"16px",fontWeight:"500",color:"#1f2937",marginBottom:"8px"},children:[i.jsx(ca,{style:{width:"16px",height:"16px"}}),"Choose Summary Model"]}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"12px"},children:"Select the AI model that will create the final comprehensive summary of all model responses"}),i.jsxs("select",{value:((R=l.summaryModelId)==null?void 0:R.toString())||"",onChange:n?void 0:w=>b(w.target.value),onClick:n?()=>a():void 0,disabled:n||!l.isEnabled,style:{width:"100%",padding:"8px 12px",borderRadius:"6px",border:"1px solid #d1d5db",fontSize:"14px",color:"#374151",backgroundColor:n||!l.isEnabled?"#f9fafb":"white",cursor:n||!l.isEnabled?"not-allowed":"pointer",opacity:n?.6:1},children:[i.jsx("option",{value:"",children:"Select a model for summarization"}),T.map(w=>i.jsxs("option",{value:w.id.toString(),children:[w.provider," - ",w.name]},w.id))]})]}),i.jsx("div",{style:{height:"1px",backgroundColor:"#e5e7eb",margin:"24px 0"}}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"16px",fontWeight:"500",color:"#1f2937",marginBottom:"8px"},children:"Active Models"}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"16px"},children:"Select which models to include in the model fusion analysis"}),i.jsx("div",{style:{border:"1px solid #d1d5db",borderRadius:"8px",overflow:"hidden"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{backgroundColor:"#3b82f6"},children:[i.jsx("th",{style:{textAlign:"left",padding:"12px",fontWeight:"500",fontSize:"14px",color:"white"},children:"Provider"}),i.jsx("th",{style:{textAlign:"left",padding:"12px",fontWeight:"500",fontSize:"14px",color:"white"},children:"Model Name"}),i.jsx("th",{style:{textAlign:"center",padding:"12px",fontWeight:"500",fontSize:"14px",color:"white"},children:"Include in Research"})]})}),i.jsx("tbody",{children:T.map((w,L)=>i.jsxs("tr",{style:{backgroundColor:L%2===0?"white":"#f8fafc",borderTop:L>0?"1px solid #e5e7eb":"none"},children:[i.jsx("td",{style:{padding:"12px"},children:i.jsx("span",{style:{display:"inline-block",padding:"2px 8px",fontSize:"12px",fontWeight:"500",color:"#374151",backgroundColor:"#f3f4f6",borderRadius:"9999px"},children:w.provider})}),i.jsx("td",{style:{padding:"12px",fontSize:"14px",color:"#374151"},children:w.name}),i.jsx("td",{style:{padding:"12px",textAlign:"center"},children:i.jsx("input",{type:"checkbox",id:`model-${w.id}`,checked:u.has(w.id),onChange:n?void 0:U=>x(w.id,U.target.checked),onClick:n?()=>a():void 0,disabled:n||!l.isEnabled,style:{width:"16px",height:"16px",cursor:n||!l.isEnabled?"not-allowed":"pointer",opacity:n?.6:1}})})]},w.id))})]})})]})]})})}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[i.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"1px solid #e5e7eb",padding:"24px"},children:i.jsxs("button",{onClick:n?()=>a():v,disabled:n||g.isPending,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"500",color:"white",backgroundColor:n||g.isPending?"#9ca3af":"#3b82f6",border:"none",borderRadius:"8px",cursor:n||g.isPending?"not-allowed":"pointer",transition:"all 0.2s",opacity:n?.6:1},onMouseEnter:w=>{!n&&!g.isPending&&(w.currentTarget.style.backgroundColor="#2563eb")},onMouseLeave:w=>{!n&&!g.isPending&&(w.currentTarget.style.backgroundColor="#3b82f6")},children:[g.isPending?i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"AI Sentinel",style:{width:"16px",height:"16px",animation:"spin 2s linear infinite",filter:"brightness(0) invert(1)"}}):i.jsx(Pu,{style:{width:"16px",height:"16px"}}),"Save Configuration"]})}),i.jsx("div",{style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",border:"1px solid #e5e7eb",padding:"24px"},children:i.jsx("div",{style:{padding:"16px",backgroundColor:"#eff6ff",borderRadius:"8px",border:"1px solid #bfdbfe"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(ba,{style:{width:"20px",height:"20px",color:"#2563eb",marginTop:"2px",flexShrink:0}}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"14px",fontWeight:"500",color:"#1e40af",marginBottom:"8px",margin:"0 0 8px 0"},children:"How Model Fusion Works"}),i.jsxs("ul",{style:{fontSize:"14px",color:"#1e40af",margin:0,paddingLeft:"0",listStyle:"none"},children:[i.jsx("li",{style:{marginBottom:"4px"},children:'â€¢ Users will see "Model Fusion" as an option in the AI model selector'}),i.jsx("li",{style:{marginBottom:"4px"},children:"â€¢ The prompt is sent to all selected AI models simultaneously"}),i.jsx("li",{style:{marginBottom:"4px"},children:"â€¢ Individual responses are collected and combined"}),i.jsx("li",{style:{marginBottom:"4px"},children:"â€¢ The selected summary model creates a comprehensive analysis"}),i.jsx("li",{style:{marginBottom:"4px"},children:"â€¢ Processing may take several minutes depending on model count"})]})]})]})})})]})]})}),n&&o&&i.jsx(o,{})]})}function $J(){const{toast:e}=Mt(),t=Xn(),{user:n}=Nt(),r=er(n),{showDialog:s,closeDialog:o,DialogComponent:a}=Kr(),l=j=>{const A={title:"API Configuration",description:"Secure API key management for multiple AI providers with comprehensive testing and validation features.",features:["Secure encrypted storage of API keys for OpenAI, Anthropic, Google, Cohere, Mistral AI","Real-time API key validation and connection testing","Provider-specific rate limiting and timeout configuration","Connection status monitoring with detailed error reporting","Automatic API key rotation and expiration tracking","Advanced security features including key masking and audit logging"]};o(),setTimeout(()=>{s(A)},10)},c=jd(n,La.SETUP_API_KEYS),[u,d]=E.useState(null),[p,f]=E.useState({}),[h,y]=E.useState({}),[g,S]=E.useState({}),[b,x]=E.useState({}),{data:v,isLoading:T,error:R}=ct({queryKey:["/api/ai-models"]}),{data:w,isLoading:L,error:U}=ct({queryKey:["/api/admin/api-keys"]});console.log("SetupApiKeys: Query state:",{isLoading:T,hasData:!!v,dataLength:v==null?void 0:v.length,error:R,apiKeyConfig:w,apiKeyLoading:L,apiKeyError:U,userAuth:{isAuthenticated:!!n,roleLevel:n==null?void 0:n.roleLevel,companyId:n==null?void 0:n.companyId}}),E.useEffect(()=>{if(w&&v){console.log("SetupApiKeys: Loading API key config:",w),console.log("SetupApiKeys: Loading AI models:",v.length,"models");const j={};v.forEach(A=>{const M=A.provider.toLowerCase();A.apiKey&&!A.apiKey.startsWith("placeholder-")&&!j[M]&&(j[M]=A.apiKey,console.log(`SetupApiKeys: Found database API key for ${M}:`,A.apiKey.substring(0,15)+"..."))}),Object.entries(w).forEach(([A,M])=>{M.configured&&M.source==="environment"?j[A]="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢(configured via environment)":j[A]||(j[A]=""),console.log(`SetupApiKeys: Provider ${A} - configured: ${M.configured}, source: ${M.source||"none"}`)}),console.log("SetupApiKeys: Final API keys state:",Object.keys(j).map(A=>{var M;return{provider:A,hasKey:!!j[A],keyLength:(M=j[A])==null?void 0:M.length}})),x(j)}},[w,v]);const Y=st({mutationFn:async({provider:j,apiKey:A})=>vt("/api/admin/update-api-key","POST",{provider:j,apiKey:A}),onSuccess:(j,A)=>{t.invalidateQueries({queryKey:["/api/ai-models"]}),t.invalidateQueries({queryKey:["/api/admin/api-keys"]}),e({title:"Success",description:`${A.provider} API key updated successfully`}),x(M=>({...M,[A.provider]:`${A.provider.toUpperCase()}_API_KEY_CONFIGURED`}))},onError:(j,A)=>{e({title:"Error",description:j.message||`Failed to update ${A.provider} API key`,variant:"destructive"})}}),D=[{id:"openai",name:"OpenAI",icon:ca,description:"GPT models for text generation and conversation",keyPlaceholder:"sk-proj-...",models:(v==null?void 0:v.filter(j=>j.provider==="openai"))||[],instructions:"Get your API key from platform.openai.com/api-keys"},{id:"anthropic",name:"Anthropic",icon:jt,description:"Claude models for reasoning and analysis",keyPlaceholder:"sk-ant-...",models:(v==null?void 0:v.filter(j=>j.provider==="anthropic"))||[],instructions:"Get your API key from console.anthropic.com/keys"},{id:"perplexity",name:"Perplexity",icon:Lu,description:"Real-time search and information retrieval",keyPlaceholder:"pplx-...",models:(v==null?void 0:v.filter(j=>j.provider==="perplexity"))||[],instructions:"Get your API key from perplexity.ai/settings/api"},{id:"google",name:"Google",icon:Lu,description:"Gemini models for multimodal AI capabilities",keyPlaceholder:"AIza...",models:(v==null?void 0:v.filter(j=>j.provider==="google"))||[],instructions:"Get your API key from console.cloud.google.com"},{id:"cohere",name:"Cohere",icon:ca,description:"Command models for enterprise applications",keyPlaceholder:"co-...",models:(v==null?void 0:v.filter(j=>j.provider==="cohere"))||[],instructions:"Get your API key from dashboard.cohere.ai"},{id:"mistral",name:"Mistral AI",icon:ca,description:"Open-source and commercial language models",keyPlaceholder:"...",models:(v==null?void 0:v.filter(j=>j.provider==="mistral"))||[],instructions:"Get your API key from console.mistral.ai"}],O=(j,A)=>{x(N=>({...N,[j]:A})),f(N=>({...N,[j]:null})),S(N=>({...N,[j]:""}));const M=(v==null?void 0:v.filter(N=>N.provider===j))||[],G={...h};M.forEach(N=>{delete G[N.id.toString()]}),y(G)},C=j=>{const A=b[j];if(!A||A.trim()===""||A.startsWith("placeholder-")){e({title:"Invalid API Key",description:"Please enter a valid API key",variant:"destructive"});return}Y.mutate({provider:j,apiKey:A.trim()})},_=async j=>{const A=b[j];if(console.log("testConnection called for provider:",j,"apiKey length:",A==null?void 0:A.length),!A||A.startsWith("placeholder-")||A.includes("$")){console.log("Invalid API key detected"),f(ee=>({...ee,[j]:"error"})),S(ee=>({...ee,[j]:"Please enter a real API key (not placeholder or environment variable)"}));return}console.log("Setting testing state for provider:",j),d(j),f(ee=>({...ee,[j]:null})),S(ee=>({...ee,[j]:""}));const M=(v==null?void 0:v.filter(ee=>ee.provider===j))||[];console.log(`Testing ${M.length} models for provider: ${j}`);const G={...h};M.forEach(ee=>{delete G[ee.id.toString()]}),y(G);let N=!0,le=0;try{for(const ee of M){console.log(`Testing model: ${ee.name} (ID: ${ee.id})`);try{const I=await vt("/api/admin/test-api-key","POST",{provider:j,apiKey:A,modelId:ee.id.toString()});console.log(`Model ${ee.name} test result:`,I),I.success?y(ie=>({...ie,[ee.id.toString()]:"success"})):(y(ie=>({...ie,[ee.id.toString()]:"error"})),N=!1,le++)}catch(I){console.error(`Model ${ee.name} test error:`,I),y(ie=>({...ie,[ee.id.toString()]:"error"})),N=!1,le++}}N?(f(ee=>({...ee,[j]:"success"})),S(ee=>({...ee,[j]:`All ${M.length} models tested successfully`}))):(f(ee=>({...ee,[j]:"error"})),S(ee=>({...ee,[j]:`${le} of ${M.length} models failed`})))}catch(ee){console.error("Test connection error:",ee),f(I=>({...I,[j]:"error"})),S(I=>({...I,[j]:ee.message||"Connection test failed"}))}finally{console.log("Clearing testing state for provider:",j),d(null)}},k=j=>{var N;const A=j.id||j.provider||((N=j.name)==null?void 0:N.toLowerCase()),M=w==null?void 0:w[A];return b[A]&&b[A]!==""||(M==null?void 0:M.configured)?"connected":"needs-key"},B=j=>{const A=w==null?void 0:w[j];return(A==null?void 0:A.configured)&&(A==null?void 0:A.source)==="environment"};return c?T||L?i.jsx(qe,{title:"Setup API Keys",subtitle:"Configure AI provider API keys",children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"256px",flexDirection:"column",gap:"16px"},children:[i.jsx("div",{style:{width:"64px",height:"64px",animation:"spin 2s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Loading...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})}),i.jsx("p",{style:{fontSize:"16px",color:"#64748b"},children:"Loading API configuration..."}),i.jsx("style",{children:`
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
          `})]})}):i.jsxs(qe,{title:"Setup API Keys",subtitle:"Configure AI provider API keys",rightContent:i.jsx(Ui,{message:"Demo Mode - Read Only View - API keys cannot be modified"}),children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[i.jsx(ni,{style:{border:"1px solid #bfdbfe",backgroundColor:"#eff6ff"},children:i.jsx(ri,{style:{paddingTop:"24px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(ba,{style:{width:"20px",height:"20px",color:"#2563eb",marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontWeight:"500",color:"#1e3a8a",margin:"0 0 4px 0"},children:"Company API Key Management"}),i.jsx("p",{style:{fontSize:"14px",color:"#1d4ed8",margin:"0",lineHeight:"1.5"},children:"As a company owner, you can configure API keys for all AI providers. These keys will be used by your company for AI model functionality. Make sure to use valid, working API keys to enable AI features for your organization."})]})]})})}),i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"24px",marginTop:"24px"},children:D.map(j=>{const A=k(j),M=b[j.id]||"",G=B(j.id),N=!G&&(M.startsWith("placeholder-")||M===""),le=A==="connected";return i.jsxs(ni,{style:{border:le?"1px solid #bbf7d0":"1px solid #fecaca",backgroundColor:le?"#f0fdf4":"#fef2f2",height:"fit-content"},children:[i.jsxs(Ji,{style:{paddingBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[i.jsx(j.icon,{style:{width:"24px",height:"24px",color:"#1e3a8a"}}),i.jsxs("div",{children:[i.jsx(es,{style:{fontSize:"18px",fontWeight:"600",margin:"0"},children:j.name}),i.jsx(aZ,{style:{fontSize:"14px",color:"#6b7280",margin:"4px 0 0 0"},children:j.description})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx(to,{style:{backgroundColor:le?"#dcfce7":"#fee2e2",color:le?"#166534":"#991b1b",border:"none",fontSize:"12px",padding:"4px 8px"},children:le?G?"Configured":"API Key Set":"Not configured"}),i.jsxs("span",{style:{fontSize:"12px",color:"#3b82f6",fontWeight:"500"},children:[j.models.length," model",j.models.length!==1?"s":""]})]})]}),i.jsxs(ri,{style:{paddingTop:"0"},children:[i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsx(Hn,{htmlFor:`${j.id}-key`,style:{fontSize:"14px",fontWeight:"500",color:"#374151",display:"block",marginBottom:"8px"},children:"API Key"}),i.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[i.jsx(Ff,{id:`${j.id}-key`,type:"password",placeholder:G?"Configured via environment variables":j.keyPlaceholder,value:M,onChange:r||G?void 0:ee=>O(j.id,ee.target.value),onClick:r?()=>l():void 0,disabled:r||G,style:{flex:"1",border:le?"1px solid #86efac":"1px solid #fca5a5",borderRadius:"6px",padding:"8px 12px",opacity:r||G?.6:1,cursor:r||G?"not-allowed":"text",color:G?"#059669":"inherit"}}),i.jsxs(Vn,{onClick:r?()=>l():()=>C(j.id),disabled:r||G||Y.isPending,style:{backgroundColor:r||G||!M||M.includes("(configured")?"transparent":"#1e3a8a",color:r||G||!M||M.includes("(configured")?"#1e3a8a":"white",border:r||G||!M||M.includes("(configured")?"1px solid #1e3a8a":"none",borderRadius:"6px",padding:"8px 16px",display:"flex",alignItems:"center",gap:"4px",fontSize:"14px",cursor:r||G||Y.isPending?"not-allowed":"pointer",opacity:r||G?.6:1},children:[Y.isPending?i.jsx("div",{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Loading",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.1) saturate(1.3) contrast(1.2)"}})}):i.jsx(yl,{style:{width:"16px",height:"16px"}}),Y.isPending?"Saving...":"Save",i.jsx("style",{children:`
                          @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                          }
                        `})]})]}),i.jsx("p",{style:{fontSize:"12px",color:"#6b7280",margin:"0"},children:G?"This API key is configured via environment variables and ready to use.":j.instructions}),N&&!G&&i.jsxs("p",{style:{fontSize:"13px",color:"#dc2626",margin:"8px 0 0 0"},children:["âš  Enter your real API key to enable ",j.name," models"]}),G&&i.jsxs("p",{style:{fontSize:"13px",color:"#059669",margin:"8px 0 0 0"},children:["âœ“ ",j.name," is configured and ready for AI interactions"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"16px"},children:[i.jsxs("div",{style:{flex:"1"},children:[i.jsx(Hn,{style:{fontSize:"14px",fontWeight:"500",color:"#374151",display:"block",marginBottom:"8px"},children:"Available Models"}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:j.models.map(ee=>{const I=h[ee.id.toString()];return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 8px",backgroundColor:"#f9fafb",border:"1px solid #e5e7eb",borderRadius:"4px"},children:[i.jsx("span",{style:{fontSize:"12px",color:"#374151",flex:"1"},children:ee.name}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(to,{style:{backgroundColor:"#f3f4f6",color:"#6b7280",border:"1px solid #d1d5db",fontSize:"10px",padding:"1px 4px"},children:ee.modelId}),I==="success"&&i.jsx(Tx,{style:{width:"14px",height:"14px",color:"#16a34a"}}),I==="error"&&i.jsx($r,{style:{width:"14px",height:"14px",color:"#dc2626"}}),I===null&&u===j.id&&i.jsx(kp,{style:{width:"14px",height:"14px",color:"#6b7280"}})]})]},ee.id)})})]}),i.jsxs("button",{onClick:r?()=>l():ee=>{ee.preventDefault(),ee.stopPropagation(),console.log("Button clicked for provider:",j.id),_(j.id)},disabled:r||u===j.id||N,style:{backgroundColor:"transparent",color:p[j.id]==="success"?"#16a34a":p[j.id]==="error"?"#dc2626":"#1e3a8a",border:`1px solid ${p[j.id]==="success"?"#16a34a":p[j.id]==="error"?"#dc2626":"#1e3a8a"}`,borderRadius:"6px",padding:"6px 12px",display:"flex",alignItems:"center",gap:"4px",fontSize:"13px",cursor:r||N?"not-allowed":"pointer",opacity:r||N?"0.5":"1",marginLeft:"16px",marginTop:"24px"},children:[u===j.id?i.jsx(kp,{style:{width:"14px",height:"14px"}}):p[j.id]==="success"?i.jsx(Tx,{style:{width:"14px",height:"14px"}}):p[j.id]==="error"?i.jsx($r,{style:{width:"14px",height:"14px"}}):i.jsx(kp,{style:{width:"14px",height:"14px"}}),u===j.id?"Testing...":"Test Connection"]})]}),g[j.id]&&i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"8px"},children:i.jsx("div",{style:{fontSize:"12px",color:p[j.id]==="success"?"#16a34a":"#dc2626",fontStyle:"italic"},children:g[j.id]})}),i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-start",marginTop:"16px"},children:i.jsxs("div",{style:{fontSize:"13px",color:"#6b7280"},children:["Status: ",i.jsx("span",{style:{fontWeight:"500",color:N?"#dc2626":"#16a34a"},children:N?"Not configured":"Configured"})]})})]})]},j.name)})}),i.jsx(ni,{style:{border:"1px solid #fde68a",backgroundColor:"#fffbeb"},children:i.jsx(ri,{style:{paddingTop:"24px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsx(xl,{style:{width:"20px",height:"20px",color:"#d97706",marginTop:"2px"}}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontWeight:"500",color:"#92400e",margin:"0 0 4px 0"},children:"Security Notice"}),i.jsx("p",{style:{fontSize:"14px",color:"#b45309",margin:"0",lineHeight:"1.5"},children:"API keys are stored securely in the database and are only accessible to super-users. Make sure to use API keys from accounts you control and monitor usage regularly."})]})]})})})]}),r&&a&&i.jsx(a,{})]}):i.jsx(qe,{title:"Setup API Keys",subtitle:"Configure AI provider API keys",children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"256px",gap:"16px"},children:[i.jsx(jt,{style:{width:"48px",height:"48px",color:"#ef4444"}}),i.jsxs("div",{style:{textAlign:"center"},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#374151",margin:"0 0 8px 0"},children:"Access Denied"}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:0},children:"Owner access required (level 99+)"})]})]})})}function qJ(){const{toast:e}=Mt(),{user:t}=Nt(),[n,r]=E.useState([]),[s,o]=E.useState(!0),[a,l]=E.useState(null),[c,u]=E.useState(!1),[d,p]=E.useState(!1),[f,h]=E.useState(!1),[y,g]=E.useState(null),[S,b]=E.useState({email:"",firstName:"",lastName:"",role:"user",roleLevel:1,department:""});if(!t||!Hh(t.roleLevel,100))return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",textAlign:"center",padding:"2rem"},children:[i.jsx(Cx,{style:{width:"4rem",height:"4rem",color:"#dc2626",marginBottom:"1rem"}}),i.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#1f2937"},children:"Super-User Access Required"}),i.jsx("p",{style:{color:"#6b7280",marginBottom:"1rem"},children:"You need super-user privileges (level 100+) to manage user roles."}),i.jsxs("p",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:["Current access level: ",(t==null?void 0:t.roleLevel)||0]})]});const x=async()=>{try{o(!0);const _=await fetch("/api/admin/all-users",{credentials:"include"});if(_.ok){const k=await _.json();r(k)}else e({title:"Error",description:"Failed to fetch users",variant:"destructive"})}catch(_){console.error("Error fetching users:",_),e({title:"Error",description:"Failed to fetch users",variant:"destructive"})}finally{o(!1)}},v=async(_,k)=>{try{l(_),(await fetch(`/api/admin/users/${_}/role`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({roleLevel:k})})).ok?(await x(),e({title:"Success",description:"User role updated successfully"})):e({title:"Error",description:"Failed to update user role",variant:"destructive"})}catch(B){console.error("Error updating user role:",B),e({title:"Error",description:"Failed to update user role",variant:"destructive"})}finally{l(null)}},T=_=>_>=100?"#dc2626":_>=99?"#7c3aed":_>=2?"#f59e0b":"#10b981",R=_=>_>=100?"Super-User":_>=99?"Owner":_>=98?"Administrator":_>=2?"Admin":"User";if(E.useEffect(()=>{x()},[]),s)return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px"},children:[i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Loading",style:{width:"64px",height:"64px",animation:"spin 2s linear infinite",filter:"brightness(1.1) saturate(1.3) contrast(1.2)",marginBottom:"1rem"}}),i.jsx("p",{style:{color:"#6b7280"},children:"Loading users..."})]});const w=n.length,L=n.filter(_=>_.status==="active").length,U=n.filter(_=>_.roleLevel>=98).length,Y=n.reduce((_,k)=>_+(k.totalSessions||0),0),D=async()=>{try{(await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(S)})).ok?(await x(),u(!1),b({email:"",firstName:"",lastName:"",role:"user",roleLevel:1,department:""}),e({title:"Success",description:"User created successfully"})):e({title:"Error",description:"Failed to create user",variant:"destructive"})}catch{e({title:"Error",description:"Failed to create user",variant:"destructive"})}},O=async()=>{if(y)try{(await fetch(`/api/admin/users/${y.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(S)})).ok?(await x(),p(!1),g(null),e({title:"Success",description:"User updated successfully"})):e({title:"Error",description:"Failed to update user",variant:"destructive"})}catch{e({title:"Error",description:"Failed to update user",variant:"destructive"})}},C=async()=>{if(y)try{(await fetch(`/api/admin/users/${y.id}`,{method:"DELETE",credentials:"include"})).ok?(await x(),h(!1),g(null),e({title:"Success",description:"User deleted successfully"})):e({title:"Error",description:"Failed to delete user",variant:"destructive"})}catch{e({title:"Error",description:"Failed to delete user",variant:"destructive"})}};return i.jsxs(qe,{title:"User Management",subtitle:"Manage user accounts, roles, and permissions",children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"24px",marginBottom:"32px"},children:[i.jsxs("div",{style:{backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{backgroundColor:"#dbeafe",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Cr,{style:{width:"24px",height:"24px",color:"#3b82f6"}})}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"#1e293b"},children:w}),i.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Total Users"})]})]}),i.jsxs("div",{style:{backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{backgroundColor:"#dcfce7",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(jt,{style:{width:"24px",height:"24px",color:"#22c55e"}})}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"#1e293b"},children:L}),i.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Active Users"})]})]}),i.jsxs("div",{style:{backgroundColor:"#fffbeb",border:"1px solid #fed7aa",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{backgroundColor:"#fef3c7",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Cx,{style:{width:"24px",height:"24px",color:"#f59e0b"}})}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"#1e293b"},children:U}),i.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Administrators"})]})]}),i.jsxs("div",{style:{backgroundColor:"#faf5ff",border:"1px solid #e9d5ff",borderRadius:"12px",padding:"24px",display:"flex",alignItems:"center",gap:"16px"},children:[i.jsx("div",{style:{backgroundColor:"#f3e8ff",borderRadius:"12px",padding:"12px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(va,{style:{width:"24px",height:"24px",color:"#8b5cf6"}})}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"#1e293b"},children:Y}),i.jsx("div",{style:{fontSize:"14px",color:"#64748b"},children:"Total Sessions"})]})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[i.jsxs("div",{children:[i.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#1e293b",margin:0},children:"All Users"}),i.jsx("p",{style:{color:"#64748b",margin:"4px 0 0 0"},children:"Manage user accounts and permissions"})]}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsxs(Vn,{onClick:x,disabled:s,style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(pf,{style:{width:"16px",height:"16px"}}),"Refresh"]}),i.jsxs(Vn,{onClick:()=>u(!0),style:{display:"flex",alignItems:"center",gap:"8px",backgroundColor:"#3b82f6",color:"white"},children:[i.jsx(Tn,{style:{width:"16px",height:"16px"}}),"Invite User"]})]})]}),i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",border:"1px solid #e2e8f0",overflow:"hidden"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1.5fr 1fr 1fr 150px",gap:"16px",padding:"20px",backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0",fontWeight:"600",color:"#1e293b",fontSize:"14px"},children:[i.jsx("div",{children:"Email"}),i.jsx("div",{children:"Name"}),i.jsx("div",{children:"Current Role"}),i.jsx("div",{children:"Role Level"}),i.jsx("div",{children:"Actions"})]}),n.map(_=>{const k=_.name||`${_.firstName||""} ${_.lastName||""}`.trim()||"N/A",B=_.totalSessions||0;return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1.5fr 1fr 1fr 150px",gap:"16px",padding:"20px",borderBottom:"1px solid #e2e8f0",alignItems:"center",transition:"background-color 0.2s"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"4px"},children:_.email}),i.jsxs("div",{style:{fontSize:"12px",color:"#64748b"},children:[B," sessions"]})]}),i.jsx("div",{style:{color:"#475569"},children:k}),i.jsx("div",{children:i.jsx("span",{style:{display:"inline-block",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"500",backgroundColor:`${T(_.roleLevel)}20`,color:T(_.roleLevel)},children:R(_.roleLevel)})}),i.jsx("div",{children:i.jsxs("select",{value:_.roleLevel,onChange:j=>v(_.id,parseInt(j.target.value)),disabled:a===_.id,style:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #d1d5db",backgroundColor:"white",fontSize:"14px",cursor:a===_.id?"not-allowed":"pointer",width:"100%"},children:[i.jsx("option",{value:1,children:"User (1)"}),i.jsx("option",{value:2,children:"Admin (2)"}),i.jsx("option",{value:98,children:"Admin (98)"}),i.jsx("option",{value:99,children:"Owner (99)"}),i.jsx("option",{value:100,children:"Super-User (100)"})]})}),i.jsx("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:a===_.id?i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#64748b",fontSize:"12px"},children:[i.jsx(pf,{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"}}),"Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>{g(_),b({email:_.email,firstName:_.firstName||"",lastName:_.lastName||"",role:_.role,roleLevel:_.roleLevel,department:_.department||""}),p(!0)},style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"#f1f5f9",color:"#475569",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Edit user",children:i.jsx(Ao,{style:{width:"16px",height:"16px"}})}),i.jsx("button",{onClick:()=>{g(_),h(!0)},style:{padding:"6px",borderRadius:"6px",border:"none",backgroundColor:"#fef2f2",color:"#dc2626",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Delete user",children:i.jsx(Gn,{style:{width:"16px",height:"16px"}})})]})})]},_.id)}),n.length===0&&i.jsx("div",{style:{padding:"3rem",textAlign:"center",color:"#6b7280"},children:"No users found"})]}),i.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"8px"},children:[i.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#0369a1",marginBottom:"0.5rem"},children:"Testing Setup Information"}),i.jsxs("div",{style:{color:"#0c4a6e",fontSize:"0.875rem",lineHeight:"1.5"},children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Super-User (100):"})," Full system access, company management, role changes"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Owner (99):"})," Company setup, AI models, API keys, model fusion"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Admin (2):"})," User management, security settings, activity management"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"User (1):"})," Chat interface access only"]})]})]}),c&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",width:"480px",maxWidth:"90vw"},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"16px",color:"#1e293b"},children:"Invite New User"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Email"}),i.jsx("input",{type:"email",value:S.email,onChange:_=>b({...S,email:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"},placeholder:"user@example.com"})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"First Name"}),i.jsx("input",{type:"text",value:S.firstName,onChange:_=>b({...S,firstName:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"},placeholder:"John"})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Last Name"}),i.jsx("input",{type:"text",value:S.lastName,onChange:_=>b({...S,lastName:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"},placeholder:"Doe"})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Role"}),i.jsxs("select",{value:S.roleLevel,onChange:_=>b({...S,roleLevel:parseInt(_.target.value)}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"},children:[i.jsx("option",{value:1,children:"User (1)"}),i.jsx("option",{value:2,children:"Admin (2)"}),i.jsx("option",{value:98,children:"Admin (98)"}),i.jsx("option",{value:99,children:"Owner (99)"}),i.jsx("option",{value:100,children:"Super-User (100)"})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Department"}),i.jsx("input",{type:"text",value:S.department,onChange:_=>b({...S,department:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"},placeholder:"Engineering"})]})]}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px"},children:[i.jsx(Vn,{onClick:()=>u(!1),style:{flex:1,backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0"},children:"Cancel"}),i.jsx(Vn,{onClick:D,style:{flex:1,backgroundColor:"#3b82f6",color:"white"},children:"Create User"})]})]})}),d&&y&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",width:"480px",maxWidth:"90vw"},children:[i.jsxs("h3",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"16px",color:"#1e293b"},children:["Edit User: ",y.email]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"First Name"}),i.jsx("input",{type:"text",value:S.firstName,onChange:_=>b({...S,firstName:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Last Name"}),i.jsx("input",{type:"text",value:S.lastName,onChange:_=>b({...S,lastName:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Role"}),i.jsxs("select",{value:S.roleLevel,onChange:_=>b({...S,roleLevel:parseInt(_.target.value)}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"},children:[i.jsx("option",{value:1,children:"User (1)"}),i.jsx("option",{value:2,children:"Admin (2)"}),i.jsx("option",{value:98,children:"Admin (98)"}),i.jsx("option",{value:99,children:"Owner (99)"}),i.jsx("option",{value:100,children:"Super-User (100)"})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px",color:"#374151"},children:"Department"}),i.jsx("input",{type:"text",value:S.department,onChange:_=>b({...S,department:_.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]})]}),i.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px"},children:[i.jsx(Vn,{onClick:()=>{p(!1),g(null)},style:{flex:1,backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0"},children:"Cancel"}),i.jsx(Vn,{onClick:O,style:{flex:1,backgroundColor:"#3b82f6",color:"white"},children:"Update User"})]})]})}),f&&y&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:i.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"24px",width:"400px",maxWidth:"90vw"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[i.jsx("div",{style:{backgroundColor:"#fef2f2",borderRadius:"50%",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(Gn,{style:{width:"20px",height:"20px",color:"#dc2626"}})}),i.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",color:"#1e293b",margin:0},children:"Delete User"})]}),i.jsxs("p",{style:{color:"#64748b",marginBottom:"24px",lineHeight:"1.5"},children:["Are you sure you want to delete ",i.jsx("strong",{children:y.email}),"? This action cannot be undone and will permanently remove the user and all their data."]}),i.jsxs("div",{style:{display:"flex",gap:"12px"},children:[i.jsx(Vn,{onClick:()=>{h(!1),g(null)},style:{flex:1,backgroundColor:"#f8fafc",color:"#64748b",border:"1px solid #e2e8f0"},children:"Cancel"}),i.jsx(Vn,{onClick:C,style:{flex:1,backgroundColor:"#dc2626",color:"white"},children:"Delete User"})]})]})}),i.jsx("style",{jsx:!0,children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})}function YJ(){const[e,t]=E.useState(!1),[n,r]=E.useState(!1),[s,o]=E.useState(null),[a,l]=E.useState({majorVersion:1,minorVersion:0,patchVersion:0,title:"",description:"",isStable:!1,releaseNotes:""}),[c,u]=E.useState({title:"",description:"",category:"enhancement",importance:"medium"}),{toast:d}=Mt(),p=Xn(),{data:f=[],isLoading:h}=ct({queryKey:["/api/version/releases"],queryFn:async()=>{const T=await fetch("/api/version/releases",{credentials:"include"});if(!T.ok)throw new Error("Failed to fetch releases");return T.json()}}),{data:y=[]}=ct({queryKey:["/api/version",s,"features"],queryFn:async()=>{const T=await fetch(`/api/version/${s}/features`,{credentials:"include"});if(!T.ok)throw new Error("Failed to fetch features");return T.json()},enabled:!!s}),g=st({mutationFn:async T=>{const R=await fetch("/api/version/releases",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(T)});if(!R.ok)throw new Error("Failed to create release");return R.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/version/releases"]}),t(!1),l({majorVersion:1,minorVersion:0,patchVersion:0,title:"",description:"",isStable:!1,releaseNotes:""}),d({title:"Version created successfully"})},onError:()=>{d({title:"Failed to create version",variant:"destructive"})}}),S=st({mutationFn:async T=>{const R=await fetch("/api/version/features",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...T,versionId:s})});if(!R.ok)throw new Error("Failed to create feature");return R.json()},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/version",s,"features"]}),r(!1),u({title:"",description:"",category:"enhancement",importance:"medium"}),d({title:"Feature added successfully"})},onError:()=>{d({title:"Failed to add feature",variant:"destructive"})}}),b=T=>`${T.majorVersion}.${T.minorVersion}.${T.patchVersion}`,x=T=>({enhancement:"bg-blue-100 text-blue-800",bugfix:"bg-red-100 text-red-800",security:"bg-orange-100 text-orange-800",integration:"bg-green-100 text-green-800",ai:"bg-purple-100 text-purple-800",ui:"bg-pink-100 text-pink-800"})[T]||"bg-gray-100 text-gray-800",v=T=>T==="high"?i.jsx(ba,{className:"w-4 h-4 text-red-500"}):T==="medium"?i.jsx(lr,{className:"w-4 h-4 text-yellow-500"}):i.jsx(lr,{className:"w-4 h-4 text-green-500"});return i.jsx(qe,{title:"Version Management",subtitle:"Manage application versions, releases, and features",children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Version Management"}),i.jsx("p",{className:"text-gray-600",children:"Track and manage application versions and features"})]}),i.jsxs(rn,{open:e,onOpenChange:t,children:[i.jsx(Ls,{asChild:!0,children:i.jsxs(me,{children:[i.jsx(Tn,{className:"w-4 h-4 mr-2"}),"New Version"]})}),i.jsxs(Qt,{className:"max-w-md",children:[i.jsxs(Xt,{children:[i.jsx(Zt,{children:"Create New Version"}),i.jsx(ci,{children:"Add a new version release to track features and changes"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[i.jsxs("div",{children:[i.jsx($t,{htmlFor:"major",children:"Major"}),i.jsx(Oe,{id:"major",type:"number",value:a.majorVersion,onChange:T=>l({...a,majorVersion:parseInt(T.target.value)}),min:"0"})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"minor",children:"Minor"}),i.jsx(Oe,{id:"minor",type:"number",value:a.minorVersion,onChange:T=>l({...a,minorVersion:parseInt(T.target.value)}),min:"0"})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"patch",children:"Patch"}),i.jsx(Oe,{id:"patch",type:"number",value:a.patchVersion,onChange:T=>l({...a,patchVersion:parseInt(T.target.value)}),min:"0"})]})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"title",children:"Title"}),i.jsx(Oe,{id:"title",value:a.title,onChange:T=>l({...a,title:T.target.value}),placeholder:"Version title"})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"description",children:"Description"}),i.jsx(Ni,{id:"description",value:a.description,onChange:T=>l({...a,description:T.target.value}),placeholder:"Version description",rows:3})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Oo,{id:"stable",checked:a.isStable,onCheckedChange:T=>l({...a,isStable:T})}),i.jsx($t,{htmlFor:"stable",children:"Mark as stable release"})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"notes",children:"Release Notes"}),i.jsx(Ni,{id:"notes",value:a.releaseNotes,onChange:T=>l({...a,releaseNotes:T.target.value}),placeholder:"Detailed release notes",rows:4})]})]}),i.jsx(Fx,{children:i.jsx(me,{onClick:()=>g.mutate(a),disabled:g.isPending,children:g.isPending?"Creating...":"Create Version"})})]})]})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:h?i.jsxs("div",{className:"col-span-2 text-center py-8",children:[i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),i.jsx("p",{children:"Loading versions..."})]}):f.length===0?i.jsxs("div",{className:"col-span-2 text-center py-8",children:[i.jsx(YL,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"No versions found. Create your first version to get started."})]}):f.map(T=>i.jsxs(Sn,{className:`cursor-pointer transition-all hover:shadow-lg ${s===T.id?"ring-2 ring-blue-500":""} ${T.isCurrentVersion?"border-green-500":""}`,onClick:()=>o(T.id),children:[i.jsx(Ir,{children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsxs(Ur,{className:"flex items-center gap-2",children:[i.jsx(PL,{className:"w-5 h-5"}),"Version ",b(T),T.isCurrentVersion&&i.jsxs(dn,{variant:"default",className:"bg-green-100 text-green-800",children:[i.jsx($j,{className:"w-3 h-3 mr-1"}),"Current"]})]}),i.jsx(oi,{children:T.title})]}),i.jsx("div",{className:"flex gap-1",children:T.isStable&&i.jsx(dn,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Stable"})})]})}),i.jsxs(Fn,{children:[i.jsx("p",{className:"text-sm text-gray-600 mb-4",children:T.description}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(wL,{className:"w-3 h-3"}),new Date(T.releaseDate).toLocaleDateString()]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(ff,{className:"w-3 h-3"}),T.developerId]})]})]})]},T.id))}),s&&i.jsxs(Sn,{children:[i.jsx(Ir,{children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx(Ur,{children:"Version Features"}),i.jsxs(oi,{children:["Features and changes for version ",b(f.find(T=>T.id===s)||{})]})]}),i.jsxs(rn,{open:n,onOpenChange:r,children:[i.jsx(Ls,{asChild:!0,children:i.jsxs(me,{variant:"outline",size:"sm",children:[i.jsx(Tn,{className:"w-4 h-4 mr-2"}),"Add Feature"]})}),i.jsxs(Qt,{children:[i.jsxs(Xt,{children:[i.jsx(Zt,{children:"Add Feature"}),i.jsx(ci,{children:"Add a new feature or change to this version"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx($t,{htmlFor:"feature-title",children:"Title"}),i.jsx(Oe,{id:"feature-title",value:c.title,onChange:T=>u({...c,title:T.target.value}),placeholder:"Feature title"})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"feature-description",children:"Description"}),i.jsx(Ni,{id:"feature-description",value:c.description,onChange:T=>u({...c,description:T.target.value}),placeholder:"Feature description",rows:3})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"category",children:"Category"}),i.jsxs(ji,{value:c.category,onValueChange:T=>u({...c,category:T}),children:[i.jsx(ai,{children:i.jsx(Ii,{placeholder:"Select category"})}),i.jsxs(li,{children:[i.jsx(Rt,{value:"enhancement",children:"Enhancement"}),i.jsx(Rt,{value:"bugfix",children:"Bug Fix"}),i.jsx(Rt,{value:"security",children:"Security"}),i.jsx(Rt,{value:"integration",children:"Integration"}),i.jsx(Rt,{value:"ai",children:"AI"}),i.jsx(Rt,{value:"ui",children:"UI/UX"})]})]})]}),i.jsxs("div",{children:[i.jsx($t,{htmlFor:"importance",children:"Importance"}),i.jsxs(ji,{value:c.importance,onValueChange:T=>u({...c,importance:T}),children:[i.jsx(ai,{children:i.jsx(Ii,{placeholder:"Select importance"})}),i.jsxs(li,{children:[i.jsx(Rt,{value:"high",children:"High"}),i.jsx(Rt,{value:"medium",children:"Medium"}),i.jsx(Rt,{value:"low",children:"Low"})]})]})]})]}),i.jsx(Fx,{children:i.jsx(me,{onClick:()=>S.mutate(c),disabled:S.isPending,children:S.isPending?"Adding...":"Add Feature"})})]})]})]})}),i.jsx(Fn,{children:y.length===0?i.jsx("div",{className:"text-center py-8",children:i.jsx("p",{className:"text-gray-600",children:'No features added yet. Click "Add Feature" to get started.'})}):i.jsx("div",{className:"space-y-3",children:y.map(T=>i.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[v(T.importance),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("h4",{className:"font-medium",children:T.title}),i.jsx(dn,{className:x(T.category),children:T.category})]}),i.jsx("p",{className:"text-sm text-gray-600",children:T.description})]})]},T.id))})})]})]})})}function NE(){const{user:e}=Nt(),{toast:t}=Mt(),n=Xn(),{showDialog:r,DialogComponent:s}=Kr(),[o,a]=E.useState(null),[l,c]=E.useState(!1),[u,d]=E.useState({firstName:"",lastName:"",email:"",department:""}),[p,f]=E.useState(!1),[h,y]=E.useState({name:"",domain:"",primaryAdminName:"",primaryAdminEmail:"",primaryAdminTitle:""}),[g,S]=E.useState(!1),[b,x]=E.useState(null),{data:v,isLoading:T,refetch:R}=ct({queryKey:["/api/user/current-company"],enabled:!!(e!=null&&e.companyId)}),[w,L]=E.useState(!0),[U,Y]=E.useState(!0),[D,O]=E.useState(100),[C,_]=E.useState(28),[k,B]=E.useState(!1),[j,A]=E.useState(null),[M,G]=E.useState({width:0,height:0}),[N,le]=E.useState({width:0,height:0}),[ee,I]=E.useState({x:30,y:100,width:400,height:150}),[ie,Me]=E.useState(!1),[Be,ve]=E.useState(!1),[Ue,ot]=E.useState({x:0,y:0}),[$e,Ke]=E.useState(null);E.useEffect(()=>{v&&(L(v.showCompanyName===!0),Y(v.showCompanyLogo!==!1),O(Math.min(Math.max(v.logoSize||80,60),200)),_(Math.min(Math.max(v.companyNameSize||18,14),24)))},[v]);const{data:ye=[],isLoading:Z,refetch:fe}=ct({queryKey:[`/api/company/owners/${v==null?void 0:v.id}`],enabled:!!(v!=null&&v.id)}),Ze=()=>{a(null),d({firstName:"",lastName:"",email:"",department:""}),c(!0)},Ae=async()=>{if(v)try{const q={logoSize:D,companyNameSize:C,showCompanyName:w,showCompanyLogo:U};console.log("ðŸ’¾ Saving chat display settings to database:",q);const dt=await fetch(`/api/company/${v.id}/display-settings`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!dt.ok){const Ot=await dt.json();throw new Error(Ot.error||"Failed to save settings")}t({title:"Success",description:"Display settings saved to company profile"}),R(),n.invalidateQueries({queryKey:["/api/user/current-company"]})}catch(q){console.error("Error saving display settings:",q),t({title:"Error",description:(q==null?void 0:q.message)||"Failed to save display settings",variant:"destructive"})}},ut=q=>{var Ot;const dt=(Ot=q.target.files)==null?void 0:Ot[0];if(dt){const Yt=new FileReader;Yt.onload=St=>{var gr;const Jt=(gr=St.target)==null?void 0:gr.result;A(Jt);const rt=new Image;rt.onload=()=>{G({width:rt.naturalWidth,height:rt.naturalHeight});const xr=400,Us=Math.min(xr/rt.naturalWidth,xr/rt.naturalHeight),Nd=rt.naturalWidth*Us,Rd=rt.naturalHeight*Us;le({width:Nd,height:Rd});const I1=Math.min(Nd*.85,Nd-20),_1=Math.min(Rd*.35,Rd*.4);I({x:Math.max(10,(Nd-I1)/2),y:Math.max(10,(Rd-_1)/2),width:I1,height:_1})},rt.src=Jt,B(!0)},Yt.readAsDataURL(dt)}},oe=()=>{if(!j)return;const q=document.createElement("canvas"),dt=q.getContext("2d"),Ot=new Image;Ot.onload=()=>{const Yt=M.width/N.width,St=M.height/N.height,Jt=ee.x*Yt,rt=ee.y*St,gr=ee.width*Yt,xr=ee.height*St;q.width=gr,q.height=xr,dt==null||dt.drawImage(Ot,Jt,rt,gr,xr,0,0,gr,xr);const Us=q.toDataURL("image/jpeg",.85);v&&Ee.mutate({id:v.id,logo:Us}),B(!1),A(null)},Ot.src=j},Je=(q,dt,Ot)=>{q.preventDefault();const Yt=q.currentTarget.getBoundingClientRect(),St=q.clientX-Yt.left,Jt=q.clientY-Yt.top;ot({x:St,y:Jt}),dt==="drag"?Me(!0):dt==="resize"&&(ve(!0),Ke(Ot||null))},Tt=q=>{if(!ie&&!Be)return;const dt=q.currentTarget.getBoundingClientRect(),Ot=q.clientX-dt.left,Yt=q.clientY-dt.top;if(ie){const St=Ot-Ue.x,Jt=Yt-Ue.y;I(rt=>({...rt,x:Math.max(0,Math.min(N.width-rt.width,rt.x+St)),y:Math.max(0,Math.min(N.height-rt.height,rt.y+Jt))})),ot({x:Ot,y:Yt})}else if(Be&&$e){const St=Ot-Ue.x,Jt=Yt-Ue.y;I(rt=>{let gr={...rt};if($e.includes("right")&&(gr.width=Math.max(30,Math.min(N.width-rt.x,rt.width+St))),$e.includes("left")){const xr=Math.max(30,rt.width-St),Us=rt.width-xr;gr.x=Math.max(0,Math.min(N.width-xr,rt.x+Us)),gr.width=xr}if($e.includes("bottom")&&(gr.height=Math.max(20,Math.min(N.height-rt.y,rt.height+Jt))),$e.includes("top")){const xr=Math.max(20,rt.height-Jt),Us=rt.height-xr;gr.y=Math.max(0,Math.min(N.height-xr,rt.y+Us)),gr.height=xr}return gr}),ot({x:Ot,y:Yt})}},tr=()=>{Me(!1),ve(!1),Ke(null)},H=q=>{a(q),d({firstName:q.firstName,lastName:q.lastName,email:q.email,department:q.department||""}),c(!0)},X=q=>{y({name:q.name,domain:q.domain,primaryAdminName:q.primaryAdminName,primaryAdminEmail:q.primaryAdminEmail,primaryAdminTitle:q.primaryAdminTitle}),f(!0)},te=()=>{b&&re.mutate(b.id)},be=st({mutationFn:q=>vt(`/api/company/owners/${v==null?void 0:v.id}`,"POST",q),onSuccess:()=>{fe(),t({title:"Success",description:"Owner added successfully"}),c(!1),a(null)},onError:q=>{t({title:"Error",description:(q==null?void 0:q.message)||"Failed to add owner",variant:"destructive"})}}),$=st({mutationFn:q=>vt(`/api/company/owners/${q.userId}`,"PATCH",q),onSuccess:()=>{fe(),t({title:"Success",description:"Owner updated successfully"}),c(!1),a(null)},onError:q=>{t({title:"Error",description:(q==null?void 0:q.message)||"Failed to update owner",variant:"destructive"})}}),K=()=>{u.firstName&&u.lastName&&u.email&&(o?$.mutate({userId:o.id,firstName:u.firstName,lastName:u.lastName,email:u.email,department:u.department}):be.mutate({firstName:u.firstName,lastName:u.lastName,email:u.email,department:u.department}))},re=st({mutationFn:q=>vt(`/api/company/owners/${q}/${v==null?void 0:v.id}`,"DELETE"),onSuccess:()=>{fe(),t({title:"Success",description:"Owner deleted successfully"}),S(!1),x(null)},onError:q=>{t({title:"Error",description:(q==null?void 0:q.message)||"Failed to remove owner",variant:"destructive"})}}),Ee=st({mutationFn:({id:q,logo:dt})=>vt(`/api/admin/companies/${q}`,"PATCH",{logo:dt}),onSuccess:()=>{R(),n.invalidateQueries({queryKey:["/api/user/current-company"]}),n.invalidateQueries({queryKey:["/api/company/owners"]}),t({title:"Success",description:"Logo updated successfully"}),setTimeout(()=>{window.location.reload()},500)},onError:q=>{t({title:"Error",description:(q==null?void 0:q.message)||"Failed to update logo",variant:"destructive"})}}),ze=st({mutationFn:({id:q,data:dt})=>vt(`/api/admin/companies/${q}`,"PATCH",dt),onSuccess:()=>{R(),n.invalidateQueries({queryKey:["/api/user/current-company"]}),t({title:"Success",description:"Company information updated successfully"}),f(!1)},onError:q=>{t({title:"Error",description:(q==null?void 0:q.message)||"Failed to update company information",variant:"destructive"})}}),wt=()=>{h.name&&h.domain&&v&&ze.mutate({id:v.id,data:{name:h.name,domain:h.domain,primaryAdminName:h.primaryAdminName,primaryAdminEmail:h.primaryAdminEmail,primaryAdminTitle:h.primaryAdminTitle}})};return T?i.jsx(qe,{title:"Company Setup",subtitle:"Configure your company settings",children:i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"200px",flexDirection:"column",gap:"16px"},children:[i.jsx("div",{style:{width:"56px",height:"56px",animation:"spin 2s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Loading...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})}),i.jsx("p",{style:{fontSize:"16px",color:"#64748b"},children:"Loading company settings..."}),i.jsx("style",{children:`
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
          `})]})}):i.jsx(qe,{title:"Company Setup",subtitle:"Configure your current company and manage owners",rightContent:i.jsx(Ui,{message:"Demo Mode - Read Only View - Company settings cannot be modified"}),children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[v&&i.jsxs("div",{style:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"24px",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[i.jsx(zL,{style:{width:"20px",height:"20px",color:"#3b82f6"}}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",margin:"0"},children:"Chat Screen Preview"})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px",marginBottom:"20px",padding:"16px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0",flexWrap:"wrap"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer",opacity:(e==null?void 0:e.roleLevel)===0?.6:1},onClick:(e==null?void 0:e.roleLevel)===0?()=>r($s.COMPANY_SETUP):void 0,children:[i.jsx("input",{type:"checkbox",checked:U,onChange:(e==null?void 0:e.roleLevel)===0?void 0:q=>Y(q.target.checked),disabled:(e==null?void 0:e.roleLevel)===0,style:{width:"16px",height:"16px",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer"}}),i.jsx("span",{style:{fontSize:"14px",color:"#374151",fontWeight:"500"},children:"Show Company Logo"})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer",opacity:(e==null?void 0:e.roleLevel)===0?.6:1},onClick:(e==null?void 0:e.roleLevel)===0?()=>r($s.COMPANY_SETUP):void 0,children:[i.jsx("input",{type:"checkbox",checked:w,onChange:(e==null?void 0:e.roleLevel)===0?void 0:q=>L(q.target.checked),disabled:(e==null?void 0:e.roleLevel)===0,style:{width:"16px",height:"16px",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer"}}),i.jsx("span",{style:{fontSize:"14px",color:"#374151",fontWeight:"500"},children:"Show Company Name"})]}),i.jsx("button",{onClick:(e==null?void 0:e.roleLevel)===0?()=>r($s.COMPANY_SETUP):()=>{L(!0),Y(!0),O(80),_(18)},style:{backgroundColor:(e==null?void 0:e.roleLevel)===0?"#9ca3af":"#6b7280",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer",transition:"background-color 0.2s ease"},onMouseEnter:q=>{(e==null?void 0:e.roleLevel)!==0&&(q.currentTarget.style.backgroundColor="#4b5563")},onMouseLeave:q=>{(e==null?void 0:e.roleLevel)!==0&&(q.currentTarget.style.backgroundColor="#6b7280")},children:"Reset to Defaults"}),i.jsx("div",{style:{position:"relative"},children:(e==null?void 0:e.roleLevel)===0?i.jsxs("button",{onClick:()=>r($s.COMPANY_SETUP),style:{backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},onMouseEnter:q=>q.currentTarget.style.backgroundColor="#2563eb",onMouseLeave:q=>q.currentTarget.style.backgroundColor="#3b82f6",children:[i.jsx(wx,{style:{width:"14px",height:"14px"}}),"Learn About Logo Upload"]}):i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"file",accept:"image/*",onChange:ut,style:{display:"none"},id:"logo-upload"}),i.jsxs("label",{htmlFor:"logo-upload",style:{backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"background-color 0.2s ease",display:"flex",alignItems:"center",gap:"6px"},onMouseEnter:q=>q.currentTarget.style.backgroundColor="#15803d",onMouseLeave:q=>q.currentTarget.style.backgroundColor="#16a34a",children:[i.jsx(wx,{style:{width:"14px",height:"14px"}}),"Upload & Crop Logo"]})]})})]}),U&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"20px",padding:"16px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[i.jsx("label",{style:{fontSize:"14px",color:"#374151",minWidth:"80px",fontWeight:"500"},children:"Logo Size:"}),i.jsx("button",{onClick:(e==null?void 0:e.roleLevel)===0?()=>r($s.COMPANY_SETUP):()=>O(Math.max(60,D-10)),style:{width:"32px",height:"32px",borderRadius:"6px",border:"1px solid #cbd5e1",backgroundColor:(e==null?void 0:e.roleLevel)===0?"#f3f4f6":"#ffffff",color:(e==null?void 0:e.roleLevel)===0?"#9ca3af":"#374151",fontSize:"18px",fontWeight:"bold",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:q=>{(e==null?void 0:e.roleLevel)!==0&&(q.currentTarget.style.backgroundColor="#f1f5f9",q.currentTarget.style.borderColor="#94a3b8")},onMouseLeave:q=>{(e==null?void 0:e.roleLevel)!==0&&(q.currentTarget.style.backgroundColor="#ffffff",q.currentTarget.style.borderColor="#cbd5e1")},children:"-"}),i.jsxs("span",{style:{minWidth:"80px",textAlign:"center",fontSize:"14px",fontWeight:"600",color:"#1e293b",padding:"6px 12px",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px"},children:[D,"px"]}),i.jsx("button",{onClick:(e==null?void 0:e.roleLevel)===0?()=>r($s.COMPANY_SETUP):()=>O(Math.min(200,D+10)),style:{width:"32px",height:"32px",borderRadius:"6px",border:"1px solid #cbd5e1",backgroundColor:(e==null?void 0:e.roleLevel)===0?"#f3f4f6":"#ffffff",color:(e==null?void 0:e.roleLevel)===0?"#9ca3af":"#374151",fontSize:"18px",fontWeight:"bold",cursor:(e==null?void 0:e.roleLevel)===0?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:q=>{(e==null?void 0:e.roleLevel)!==0&&(q.currentTarget.style.backgroundColor="#f1f5f9",q.currentTarget.style.borderColor="#94a3b8")},onMouseLeave:q=>{(e==null?void 0:e.roleLevel)!==0&&(q.currentTarget.style.backgroundColor="#ffffff",q.currentTarget.style.borderColor="#cbd5e1")},children:"+"}),i.jsx("span",{style:{fontSize:"12px",color:"#64748b",marginLeft:"8px"},children:"(60-200px, header max: 56px)"})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px",padding:"16px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[i.jsx("label",{style:{fontSize:"14px",color:"#374151",minWidth:"80px",fontWeight:"500"},children:"Name Size:"}),i.jsx("button",{onClick:()=>_(Math.max(14,C-2)),style:{width:"32px",height:"32px",borderRadius:"6px",border:"1px solid #cbd5e1",backgroundColor:"#ffffff",color:"#374151",fontSize:"18px",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:q=>{q.currentTarget.style.backgroundColor="#f1f5f9",q.currentTarget.style.borderColor="#94a3b8"},onMouseLeave:q=>{q.currentTarget.style.backgroundColor="#ffffff",q.currentTarget.style.borderColor="#cbd5e1"},children:"-"}),i.jsxs("span",{style:{minWidth:"80px",textAlign:"center",fontSize:"14px",fontWeight:"600",color:"#1e293b",padding:"6px 12px",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px"},children:[C,"px"]}),i.jsx("button",{onClick:()=>_(Math.min(24,C+2)),style:{width:"32px",height:"32px",borderRadius:"6px",border:"1px solid #cbd5e1",backgroundColor:"#ffffff",color:"#374151",fontSize:"18px",fontWeight:"bold",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:q=>{q.currentTarget.style.backgroundColor="#f1f5f9",q.currentTarget.style.borderColor="#94a3b8"},onMouseLeave:q=>{q.currentTarget.style.backgroundColor="#ffffff",q.currentTarget.style.borderColor="#cbd5e1"},children:"+"}),i.jsx("span",{style:{fontSize:"12px",color:"#64748b",marginLeft:"8px"},children:"(14-24px, header max: 18px)"})]}),i.jsxs("div",{style:{backgroundColor:"#f1f5f9",border:"2px dashed #cbd5e1",borderRadius:"8px",padding:"20px",textAlign:"center"},children:[i.jsx("p",{style:{fontSize:"12px",color:"#64748b",marginBottom:"16px",fontWeight:500},children:"How this will appear on chat screen:"}),i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"24px",minHeight:"80px"},children:U||w?i.jsxs(i.Fragment,{children:[U&&i.jsx("div",{style:{position:"relative",display:"inline-block"},children:(()=>{const q=F3((v==null?void 0:v.logo)||""),dt=B3((v==null?void 0:v.name)||"");return q?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:q,alt:v.name,onError:Ot=>{var Jt;const Yt=Ot.target;Yt.style.display="none";const St=(Jt=Yt.parentElement)==null?void 0:Jt.querySelector(".logo-fallback");St&&(St.style.display="flex")},style:{maxWidth:`${D}px`,maxHeight:`${D}px`,height:"auto",width:"auto",objectFit:"contain",borderRadius:"12px",border:"3px solid #9ca3af",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}}),i.jsx("div",{className:"logo-fallback",style:{width:`${D}px`,height:`${D}px`,backgroundColor:"#3b82f6",borderRadius:"12px",display:"none",alignItems:"center",justifyContent:"center",color:"white",fontSize:`${Math.floor(D*.35)}px`,fontWeight:700,transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",position:"absolute",top:0,left:0,border:"3px solid #9ca3af"},children:dt})]}):i.jsx("div",{style:{width:`${D}px`,height:`${D}px`,backgroundColor:"#3b82f6",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:`${Math.floor(D*.35)}px`,fontWeight:700,transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"3px solid #9ca3af"},children:dt})})()}),w&&i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:`${C}px`,fontWeight:700,color:"#1e293b",transition:"all 0.3s ease"},children:v.name}),i.jsxs("div",{style:{fontSize:"12px",color:"#64748b",marginTop:"4px"},children:["Company ID: ",v.id]})]})]}):i.jsx("div",{style:{color:"#9ca3af",fontSize:"16px",fontStyle:"italic"},children:"No company branding will be displayed"})})]}),i.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px",paddingTop:"20px",borderTop:"1px solid #e5e7eb"},children:i.jsxs("button",{onClick:()=>{(e==null?void 0:e.roleLevel)===0?r($s.COMPANY_SETUP):Ae()},style:{backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",padding:"12px 24px",fontSize:"14px",fontWeight:"600",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"background-color 0.2s ease"},onMouseEnter:q=>q.currentTarget.style.backgroundColor="#2563eb",onMouseLeave:q=>q.currentTarget.style.backgroundColor="#3b82f6",children:[i.jsx(yl,{style:{width:"16px",height:"16px"}}),"Save Chat Display Settings"]})})]}),v&&i.jsxs("div",{style:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"24px",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[i.jsx(To,{style:{width:"20px",height:"20px",color:"#3b82f6"}}),i.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",margin:"0"},children:v.name}),i.jsx("span",{style:{backgroundColor:"#3b82f6",color:"#fff",padding:"2px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"500"},children:"Current Company"})]}),i.jsxs("button",{onClick:()=>X(v),style:{color:"#16a34a",backgroundColor:"transparent",border:"none",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx(Ao,{style:{width:"16px",height:"16px"}}),"Edit"]})]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[v.logo&&i.jsx("img",{src:v.logo,alt:v.name,style:{maxWidth:"48px",maxHeight:"48px",height:"auto",width:"auto",objectFit:"contain",borderRadius:"6px",border:"2px solid #9ca3af"}}),i.jsxs("div",{children:[i.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:"0 0 4px 0"},children:v.name}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0"},children:v.domain})]})]}),i.jsxs("div",{children:[i.jsx("h4",{style:{fontSize:"14px",fontWeight:"500",color:"#374151",margin:"0 0 4px 0"},children:"Primary Administrator"}),i.jsxs("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0"},children:[v.primaryAdminName," - ",v.primaryAdminTitle]}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0"},children:v.primaryAdminEmail})]})]})]}),v&&i.jsxs("div",{style:{backgroundColor:"#fff",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"24px",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(Cr,{style:{width:"20px",height:"20px",color:"#3b82f6"}}),i.jsxs("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",margin:"0"},children:["Owners (",Array.isArray(ye)?ye.length:0,")"]})]}),i.jsxs("button",{onClick:Ze,style:{backgroundColor:"#3b82f6",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx(by,{style:{width:"16px",height:"16px"}}),"Add Owner"]})]}),Z?i.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:i.jsx("div",{style:{width:"24px",height:"24px",animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Loading owners...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})})}):!Array.isArray(ye)||ye.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#6b7280"},children:[i.jsx(Cr,{style:{width:"48px",height:"48px",margin:"0 auto 16px",color:"#d1d5db"}}),i.jsx("p",{style:{fontSize:"16px",fontWeight:"500",margin:"0 0 8px 0"},children:"No owners yet"}),i.jsx("p",{style:{fontSize:"14px",margin:"0"},children:"Add owners to manage this company"})]}):i.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"16px"},children:Array.isArray(ye)&&ye.map(q=>i.jsx("div",{style:{border:"1px solid #e5e7eb",borderRadius:"8px",padding:"16px",backgroundColor:"#f9fafb"},children:i.jsxs("div",{style:{display:"flex",alignItems:"start",justifyContent:"space-between"},children:[i.jsxs("div",{style:{flex:"1"},children:[i.jsxs("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#111827",margin:"0 0 4px 0"},children:[q.firstName," ",q.lastName]}),i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 2px 0"},children:q.email}),q.department&&i.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 8px 0"},children:q.department}),i.jsx("span",{style:{backgroundColor:"#fbbf24",color:"#92400e",padding:"2px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"500"},children:q.role})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("button",{onClick:()=>H(q),style:{backgroundColor:"transparent",border:"1px solid #d1d5db",borderRadius:"4px",padding:"6px",cursor:"pointer",color:"#374151"},children:i.jsx(Ao,{style:{width:"14px",height:"14px"}})}),i.jsx("button",{onClick:()=>{x(q),S(!0)},style:{backgroundColor:"transparent",border:"1px solid #fca5a5",borderRadius:"4px",padding:"6px",cursor:"pointer",color:"#dc2626"},children:i.jsx($r,{style:{width:"14px",height:"14px"}})})]})]})},q.id))})]}),k&&j&&i.jsx("div",{style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"1000"},children:i.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",padding:"24px",width:"90%",maxWidth:"600px",maxHeight:"80vh",overflow:"auto"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"20px"},children:[i.jsx(cv,{style:{width:"24px",height:"24px",color:"#3b82f6"}}),i.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",color:"#111827",margin:"0"},children:"Crop Company Logo"})]}),i.jsxs("div",{style:{position:"relative",backgroundColor:"#f8fafc",borderRadius:"8px",padding:"20px",marginBottom:"20px",textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsxs("div",{style:{position:"relative",display:"inline-block",userSelect:"none"},onMouseMove:Tt,onMouseUp:tr,onMouseLeave:tr,children:[i.jsx("img",{src:j,alt:"Selected logo",style:{width:`${N.width}px`,height:`${N.height}px`,display:"block",borderRadius:"8px"},draggable:!1}),i.jsx("div",{style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.5)",borderRadius:"8px"},children:i.jsxs("div",{style:{position:"absolute",left:`${ee.x}px`,top:`${ee.y}px`,width:`${ee.width}px`,height:`${ee.height}px`,backgroundColor:"transparent",border:"2px solid #3b82f6",borderRadius:"4px",cursor:ie?"grabbing":"grab"},onMouseDown:q=>{q.preventDefault(),Je(q,"drag")},children:[i.jsx("div",{style:{position:"absolute",top:"-6px",left:"-6px",width:"12px",height:"12px",backgroundColor:"#3b82f6",border:"2px solid white",borderRadius:"50%",cursor:"nw-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","top-left")}}),i.jsx("div",{style:{position:"absolute",top:"-6px",right:"-6px",width:"12px",height:"12px",backgroundColor:"#3b82f6",border:"2px solid white",borderRadius:"50%",cursor:"ne-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","top-right")}}),i.jsx("div",{style:{position:"absolute",bottom:"-6px",left:"-6px",width:"12px",height:"12px",backgroundColor:"#3b82f6",border:"2px solid white",borderRadius:"50%",cursor:"sw-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","bottom-left")}}),i.jsx("div",{style:{position:"absolute",bottom:"-6px",right:"-6px",width:"12px",height:"12px",backgroundColor:"#3b82f6",border:"2px solid white",borderRadius:"50%",cursor:"se-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","bottom-right")}}),i.jsx("div",{style:{position:"absolute",top:"-4px",left:"50%",transform:"translateX(-50%)",width:"16px",height:"8px",backgroundColor:"#3b82f6",border:"1px solid white",borderRadius:"4px",cursor:"n-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","top")}}),i.jsx("div",{style:{position:"absolute",bottom:"-4px",left:"50%",transform:"translateX(-50%)",width:"16px",height:"8px",backgroundColor:"#3b82f6",border:"1px solid white",borderRadius:"4px",cursor:"s-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","bottom")}}),i.jsx("div",{style:{position:"absolute",left:"-4px",top:"50%",transform:"translateY(-50%)",width:"8px",height:"16px",backgroundColor:"#3b82f6",border:"1px solid white",borderRadius:"4px",cursor:"w-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","left")}}),i.jsx("div",{style:{position:"absolute",right:"-4px",top:"50%",transform:"translateY(-50%)",width:"8px",height:"16px",backgroundColor:"#3b82f6",border:"1px solid white",borderRadius:"4px",cursor:"e-resize"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),Je(q,"resize","right")}})]})})]}),i.jsxs("div",{style:{marginTop:"16px"},children:[i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",marginBottom:"12px"},children:[i.jsx("button",{onClick:()=>{I({x:15,y:15,width:N.width-15*2,height:N.height-15*2})},style:{backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"12px",fontWeight:"500",cursor:"pointer"},children:"Auto-Crop Full"}),i.jsx("button",{onClick:()=>{const q=N.height*.3,dt=(N.height-q)/2;I({x:20,y:dt,width:N.width-40,height:q})},style:{backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"12px",fontWeight:"500",cursor:"pointer"},children:"Auto-Crop Banner"})]}),i.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",margin:"0"},children:"Drag to move â€¢ Use handles to resize width and height independently â€¢ Auto-crop buttons for quick selection"})]})]}),i.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center",marginTop:"20px"},children:[i.jsx("button",{onClick:()=>{B(!1),A(null)},style:{backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"8px",padding:"12px 20px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},children:"Cancel"}),i.jsxs("button",{onClick:oe,style:{backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",padding:"12px 20px",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx(cv,{style:{width:"16px",height:"16px"}}),"Apply Crop"]})]})]})}),l&&i.jsx("div",{style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"1000"},children:i.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"24px",width:"100%",maxWidth:"500px",margin:"16px"},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",margin:"0 0 16px 0"},children:o?"Edit Owner":"Add New Owner"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"First Name"}),i.jsx("input",{type:"text",value:u.firstName,onChange:q=>d({...u,firstName:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Last Name"}),i.jsx("input",{type:"text",value:u.lastName,onChange:q=>d({...u,lastName:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Email"}),i.jsx("input",{type:"email",value:u.email,onChange:q=>d({...u,email:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Department (Optional)"}),i.jsx("input",{type:"text",value:u.department,onChange:q=>d({...u,department:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px"},children:[i.jsx("button",{onClick:()=>{c(!1),a(null),d({firstName:"",lastName:"",email:"",department:""})},style:{backgroundColor:"transparent",border:"1px solid #d1d5db",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",color:"#374151"},children:"Cancel"}),i.jsxs("button",{onClick:K,disabled:!u.firstName||!u.lastName||!u.email,style:{backgroundColor:"#3b82f6",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",opacity:!u.firstName||!u.lastName||!u.email?"0.5":"1"},children:[i.jsx(yl,{style:{width:"16px",height:"16px",marginRight:"6px"}}),o?"Update":"Add"," Owner"]})]})]})}),g&&b&&i.jsx("div",{style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"1000"},children:i.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"24px",width:"100%",maxWidth:"400px",margin:"16px"},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",margin:"0 0 16px 0"},children:"Confirm Delete"}),i.jsxs("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 24px 0"},children:["Are you sure you want to remove ",b.firstName," ",b.lastName," as an owner? This action cannot be undone."]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx("button",{onClick:()=>{S(!1),x(null)},style:{backgroundColor:"transparent",border:"1px solid #d1d5db",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",color:"#374151"},children:"Cancel"}),i.jsx("button",{onClick:te,style:{backgroundColor:"#dc2626",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer"},children:"Delete Owner"})]})]})}),p&&v&&i.jsx("div",{style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"1000"},children:i.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"8px",padding:"24px",width:"100%",maxWidth:"600px",margin:"16px",maxHeight:"90vh",overflow:"auto"},children:[i.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#111827",margin:"0 0 16px 0"},children:"Edit Company Information"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Company Name *"}),i.jsx("input",{type:"text",value:h.name,onChange:q=>y({...h,name:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Domain *"}),i.jsx("input",{type:"text",value:h.domain,onChange:q=>y({...h,domain:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Primary Admin Name"}),i.jsx("input",{type:"text",value:h.primaryAdminName,onChange:q=>y({...h,primaryAdminName:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Primary Admin Email"}),i.jsx("input",{type:"email",value:h.primaryAdminEmail,onChange:q=>y({...h,primaryAdminEmail:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"4px"},children:"Primary Admin Title"}),i.jsx("input",{type:"text",value:h.primaryAdminTitle,onChange:q=>y({...h,primaryAdminTitle:q.target.value}),style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px"}})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px"},children:[i.jsx("button",{onClick:()=>{f(!1),y({name:"",domain:"",primaryAdminName:"",primaryAdminEmail:"",primaryAdminTitle:""})},style:{backgroundColor:"transparent",border:"1px solid #d1d5db",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:"pointer",color:"#374151"},children:"Cancel"}),i.jsx("button",{onClick:()=>{(e==null?void 0:e.roleLevel)===0?r($s.COMPANY_EDIT):wt()},disabled:!h.name||!h.domain||ze.isPending,style:{backgroundColor:"#3b82f6",color:"#fff",border:"none",borderRadius:"6px",padding:"8px 16px",fontSize:"14px",cursor:!h.name||!h.domain||ze.isPending?"not-allowed":"pointer",opacity:!h.name||!h.domain||ze.isPending?"0.5":"1",display:"flex",alignItems:"center",gap:"6px"},children:ze.isPending?i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{width:"16px",height:"16px",animation:"spin 1s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Updating...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(2) saturate(0) contrast(1)"}})}),"Updating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(yl,{style:{width:"16px",height:"16px"}}),"Update Company"]})})]})]})}),i.jsx(s,{})]})})}function KJ(){return E.useEffect(()=>{(async()=>{try{document.cookie="sessionToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";const t=await fetch("/api/auth/dev-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"ed.duval15@gmail.com"})});if(t.ok){const n=await t.json();console.log("Fresh authentication successful:",n),setTimeout(()=>{window.location.href="/admin/company-management"},1e3)}else console.error("Failed to refresh authentication")}catch(t){console.error("Error refreshing authentication:",t)}})()},[]),i.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"24px"},children:[i.jsx("div",{style:{width:"80px",height:"80px",animation:"spin 1.5s linear infinite"},children:i.jsx("img",{src:"/ai-sentinel-logo.png",alt:"Refreshing authentication...",style:{width:"100%",height:"100%",objectFit:"contain",filter:"brightness(1.2) saturate(1.4) contrast(1.1)"}})}),i.jsx("p",{style:{fontSize:"18px",color:"#1e293b",fontWeight:"600"},children:"Refreshing authentication..."}),i.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      